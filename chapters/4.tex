\chapter{Decorated corelations: black-boxed open systems} \label{ch.deccorels}

When enough structure is available to us, we may decorate corelations too.
Furthermore, and key to the idea of `black-boxing', we get a hypergraph functor
from decorated cospans to decorated corelations. This assists with constructing
hypergraph categories of semantics for network-style diagrammatic languages.
Indeed, we will prove that every hypergraph category can be constructed using
decorated corelations, and so can every hypergraph functor.

In the next section we motivate this chapter by discussing how to construct the
category of matrices using decorations, illustrating the shortcomings of
decorated cospans and how they are overcome by decorated corelations. As usual,
we then use the subsequent two sections to get into the technical details,
defining decorated corelations (\textsection\ref{sec:dcorc}) and their functors
(\textsection\ref{sec.dcorf}). This sets us up to state and prove the climactic
theorem of Part \ref{part.maths}: roughly, decorated corelations are powerful
enough to construct all hypergraph categories and functors. We do this in
\textsection\ref{sec.allhypergraphs}. Finally, in \textsection\ref{sec:excor},
we give some examples.

\section{Black-boxed open systems} \label{sec.blackboxedsystems}

Suppose we have devices built from paths that take the signal at some input,
amplify it, and deliver it to some output. For simplicity let these signals be
real numbers, and amplication be linear: we just multiply by some fixed scalar.
We depict an example device like so:
\[
    \tikzset{every path/.style={line width=.8pt}}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (-2.5, 1.5) {};
		\node [style=sdot] (1) at (-2.5, -0) {};
		\node [style=sdot] (2) at (-2.5, -1.5) {};
		\node [style=amp] (3) at (-0.75, 2) {$5$};
		\node [style=amp] (4) at (-0.75, 1.25) {$1$};
		\node [style=amp] (5) at (-0.75, -1) {$-2$};
		\node [style=amp] (6) at (-0.75, 0.25) {$2.1$};
		\node [style=amp] (7) at (-0.75, -0.25) {$-0.4$};
		\node [style=sdot] (8) at (1, -0.5) {};
		\node [style=sdot] (9) at (1, -1.5) {};
		\node [style=sdot] (10) at (1, 0.5) {};
		\node [style=sdot] (11) at (1, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.west) to (0.center);
		\draw (4.west) to (0.center);
		\draw (6.west) to (1.center);
		\draw (7.west) to (1.center);
		\draw (5.west) to (2.center);
		\draw (3) to (11);
		\draw (4) to (11);
		\draw (6) to (10);
		\draw (7) to (8);
		\draw (5) to (8);
	\end{pgfonlayer}
\end{tikzpicture}
\]
Here there are three inputs, four outputs, and five paths. Formally, we might
model these devices as finite sets of inputs $X$, outputs $Y$, and paths $N$,
together with functions $i\maps N \to X$ and $o\maps N \to Y$ describing the
start and end of each path, and a function $s\maps N \to \R$ describing the
amplification along it. In other words, these are cospans $X \to N \leftarrow Y$
in $\FinSet^\opp$ decorated by `scalar assignment' functions $N \to \R$. This
suggests a decorated cospans construction.

Such a construction can be obtained from the lax symmetric monoidal functor
$\mathbb R^{(-)}\maps \FinSet^\opp \to \Set$ taking a finite set $N$ to the set
$\R^N$ of functions $s\maps N \to \R$, and opposite functions $f^\opp\maps N \to
M$ to the map taking $s\maps N \to \R$ to $s \circ f \maps M \to \R$. Note that
the coproduct in $\FinSet^\opp$ is the cartesian product of sets. The coherence
maps of the functor which, recall, are critical for the composition of the
decorations, are given by $\varphi_{N,M}\maps \R^N \times \R^M \to \R^{N\times
M}$, taking $(s,t) \in \R^N \times \R^M$ to the function $s \cdot t\maps N
\times M \to \R$ defined by pointwise multiplication in $\R$. 

Composition in this decorated cospan category is thus given by the
multiplication in $\R$. In detail, given decorated cospans $(X
\xrightarrow{i_X^\opp} N \xleftarrow{o_Y^\opp} Y, N \xrightarrow{s} \R)$ and $(Y
\xrightarrow{i_Y^\opp} M \xleftarrow{o_Z^\opp} Z, M \xrightarrow{t} \R)$, the
composite has a path from $x \in X$ to $z \in Z$ for every triple $(y,n,m)$
where $y \in Y$, $n \in N$, and $m \in M$, such that $n$ is a path from $x$ to
$y$ and $m$ is a path from $y$ to $z$. The scalar assigned to this path is the
product of those assigned to $n$ and $m$. For example, we have the following
composite
\[
    \tikzset{every path/.style={line width=.8pt}}
    \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (-2.5, 1.5) {};
		\node [style=sdot] (1) at (-2.5, -0) {};
		\node [style=sdot] (2) at (-2.5, -1.5) {};
		\node [style=amp] (3) at (-0.75, 2) {$5$};
		\node [style=amp] (4) at (-0.75, 1.25) {$1$};
		\node [style=amp] (5) at (-0.75, -1) {$-2$};
		\node [style=amp] (6) at (-0.75, 0.25) {$2.1$};
		\node [style=amp] (7) at (-0.75, -0.25) {$-0.4$};
		\node [style=sdot] (8) at (1, -0.5) {};
		\node [style=sdot] (9) at (4.5, 0.5) {};
		\node [style=sdot] (10) at (1, -1.5) {};
		\node [style=sdot] (11) at (4.5, -1.5) {};
		\node [style=amp] (12) at (2.75, -0.5) {$-1$};
		\node [style=amp] (13) at (2.75, 1.25) {$3$};
		\node [style=amp] (14) at (2.75, -1.5) {$-2.3$};
		\node [style=amp] (15) at (2.75, 2) {$1$};
		\node [style=sdot] (16) at (4.5, 1.5) {};
		\node [style=amp] (17) at (2.75, -0) {$3$};
		\node [style=sdot] (18) at (4.5, -0.5) {};
		\node [style=sdot] (19) at (1, 0.5) {};
		\node [style=sdot] (20) at (1, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.west) to (0.center);
		\draw (4.west) to (0.center);
		\draw (6.west) to (1.center);
		\draw (7.west) to (1.center);
		\draw (5.west) to (2.center);
		\draw (16) to (15);
		\draw (16) to (13);
		\draw (18) to (12);
		\draw (14) to (11);
		\draw (10) to (14);
		\draw (15) to (20);
		\draw (13) to (20);
		\draw (3) to (20);
		\draw (4) to (20);
		\draw (6) to (19);
		\draw (7) to (8);
		\draw (5) to (8);
		\draw (12) to (8);
		\draw (19) to (17);
		\draw (17) to (18);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\qquad = \qquad
\begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (-2.5, 1.5) {};
		\node [style=sdot] (1) at (-2.5, -0) {};
		\node [style=sdot] (2) at (-2.5, -1.5) {};
		\node [style=amp] (3) at (-0.75, 1.75) {$15$};
		\node [style=amp] (4) at (-0.75, 1.25) {$1$};
		\node [style=amp] (5) at (-0.75, -1) {$2$};
		\node [style=amp] (6) at (-0.75, -0) {$6.3$};
		\node [style=amp] (7) at (-0.75, -0.5) {$0.4$};
		\node [style=sdot] (8) at (1, -0.5) {};
		\node [style=sdot] (9) at (1, -1.5) {};
		\node [style=sdot] (10) at (1, 0.5) {};
		\node [style=sdot] (11) at (1, 1.5) {};
		\node [style=amp] (12) at (-0.75, 2.25) {$5$};
		\node [style=amp] (13) at (-0.75, 0.75) {$3$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.west) to (0.center);
		\draw (4.west) to (0.center);
		\draw (6.west) to (1.center);
		\draw (7.west) to (1.center);
		\draw (5.west) to (2.center);
		\draw (3) to (11);
		\draw (4) to (11);
		\draw (7) to (8);
		\draw (5) to (8);
		\draw (0) to (12);
		\draw (12) to (11);
		\draw (0) to (13);
		\draw (13) to (11);
		\draw (6) to (8);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\]
There are four paths between the top-most element $x_1$ of the domain and the
top-most element $z_1$ of the codomain: we may first take the path that
amplifies by $5\times$ and then the path that amplifies by $1\times$ for a total
amplification of $5\times$, or $5\times$ and $3\times$ for $15\times$, and so
on. This means we end up with four elements relating $x_1$ and $z_1$ in the
composite. The apex of the composite is in fact given by the pullback $N
\times_Y M$ of the cospan $N \xrightarrow{o_Y} Y \xleftarrow{i_Y} M$ in
$\FinSet$.

Here we again see the problem of decorated cospans: the composite of the above
puts decorations on $N\times_Y M$, which can be of much larger cardinality than
$N$ and $M$. We wish to avoid the size of our decorated cospan from growing so
fast. Moreover, from our open systems perspective, we care not about the path
but by the total amplification of the signal from some chosen input to some
chosen output. The intuition is that if we black box the system, then we cannot
tell what paths the signal took through the system, only the total amplification
from input to output.

We thus want to restrict our apex to contain at most one point for each
input--output pair $(x,y)$. We do this by pushing the decoration along the
surjection $e$ in the epi-mono factorisation of the function $N\times_YM
\xrightarrow{e} \overline{N\times_YM} \xrightarrow{m} X \times Z$. Put another
way, we want the category of decorated corelations, not decorated cospans.

Represented as decorated corelations, the above composite becomes
\[
  \tikzset{every path/.style={line width=.8pt}}
  \begin{aligned}
    \begin{tikzpicture}
      \begin{pgfonlayer}{nodelayer}
	\node [style=sdot] (0) at (-2.5, 1.5) {};
	\node [style=sdot] (1) at (-2.5, -0) {};
	\node [style=sdot] (2) at (-2.5, -1.5) {};
	\node [style=amp] (3) at (-0.75, 1.5) {$6$};
	\node [style=amp] (4) at (-0.75, -1) {$-2$};
	\node [style=amp] (5) at (-0.75, 0.25) {$2.1$};
	\node [style=amp] (6) at (-0.75, -0.25) {$-0.4$};
	\node [style=sdot] (7) at (1, -0.5) {};
	\node [style=sdot] (8) at (4.5, 0.5) {};
	\node [style=sdot] (9) at (1, -1.5) {};
	\node [style=sdot] (10) at (4.5, -1.5) {};
	\node [style=amp] (11) at (2.75, -0.5) {$-1$};
	\node [style=amp] (12) at (2.75, -1.5) {$-2.3$};
	\node [style=amp] (13) at (2.75, 1.5) {$4$};
	\node [style=sdot] (14) at (4.5, 1.5) {};
	\node [style=amp] (15) at (2.75, -0) {$3$};
	\node [style=sdot] (16) at (4.5, -0.5) {};
	\node [style=sdot] (17) at (1, 0.5) {};
	\node [style=sdot] (18) at (1, 1.5) {};
      \end{pgfonlayer}
      \begin{pgfonlayer}{edgelayer}
	\draw (3.west) to (0.center);
	\draw (5.west) to (1.center);
	\draw (6.west) to (1.center);
	\draw (4.west) to (2.center);
	\draw (14) to (13);
	\draw (16) to (11);
	\draw (12) to (10);
	\draw (9) to (12);
	\draw (13) to (18);
	\draw (3) to (18);
	\draw (5) to (17);
	\draw (6) to (7);
	\draw (4) to (7);
	\draw (11) to (7);
	\draw (17) to (15);
	\draw (15) to (16);
      \end{pgfonlayer}
    \end{tikzpicture}
  \end{aligned}
  \qquad = \qquad
  \begin{aligned}
    \begin{tikzpicture}
      \begin{pgfonlayer}{nodelayer}
	\node [style=sdot] (0) at (-2.5, 1.5) {};
	\node [style=sdot] (1) at (-2.5, -0) {};
	\node [style=sdot] (2) at (-2.5, -1.5) {};
	\node [style=amp] (3) at (-0.75, 1.5) {$24$};
	\node [style=amp] (4) at (-0.75, -1) {$2$};
	\node [style=amp] (5) at (-0.75, -0.25) {$6.7$};
	\node [style=sdot] (6) at (1, -0.5) {};
	\node [style=sdot] (7) at (1, -1.5) {};
	\node [style=sdot] (8) at (1, 0.5) {};
	\node [style=sdot] (9) at (1, 1.5) {};
      \end{pgfonlayer}
      \begin{pgfonlayer}{edgelayer}
	\draw (3.west) to (0.center);
	\draw (5.west) to (1.center);
	\draw (4.west) to (2.center);
	\draw (3) to (9);
	\draw (5) to (6);
	\draw (4) to (6);
      \end{pgfonlayer}
    \end{tikzpicture}
  \end{aligned}
\]
Note that composite is not simply the composite as decorated cospans, but the
composite decorated cospan reduced to a decorated corelation. In
\textsection\ref{ssec.matrices}, we will show that this decorated corelations
category is equivalent to the category of real vector spaces and linear maps,
with monoidal product the tensor product.

It is not a trivial fact that the above composition rule for decorated
corelations defines a category. Indeed, the reason that it is possible to push
the decoration along the surjection $e$ is that the lax symmetric monoidal
functor $\R^{(-)}\maps \FinSet^\opp \to \Set$ extends to a lax symmetric
monoidal functor $(\FinSet^\opp;\mathrm{Sur}^\opp) \to \Set$. Here
$\FinSet^\opp;\mathrm{Sur}^\opp$ is the subcategory of $\cospan(\FinSet^\opp)$
comprising cospans of the form $\xrightarrow{f^\opp}\xleftarrow{e^\opp}$, where
$f$ is any function but $e$ must be a surjection.

More generally, given a category $\mc C$ with finite colimits and a subcategory
$\mc M$ stable under pushouts, we may construct a symmetric monoidal category
$\mc C;\mc M^\opp$ with isomorphisms classes of cospans of the form
$\xrightarrow{f}\xleftarrow{m}$, where $f \in \mc C$, $m \in \mc M$, as
morphisms. The monoidal product is again derived from the coproduct in $\mc C$.

We prove two key theorems in this section. The first, Theorem \ref{thm.fcorel},
is that these decorated corelations form a hypergraph category. That is, given a
category $\mc C$ with finite colimits, factorisation system $(\mc E,\mc M)$ such
that $\mc M$ is stable under pushouts, and a lax symmetric monoidal functor 
\[
  F\maps \mc C; \mc M^\opp \longrightarrow \Set,
\]
define a decorated corelation to be, as might be expected, an $(\mc E,\mc
M)$-corelation $X \to N \leftarrow Y$ in $\mc C$ together with an element of
$FN$. Then there is a hypergraph category $F\mathrm{Corel}$ with the objects of
$\mc C$ as objects and isomorphism classes of decorated corelations as
morphisms. As usual, functors between these so-called decorated corelations
categories can be defined from natural transformations between the decorating
functors.

The second key theorem is that every hypergraph category and hypergraph
functor can be constructed in this way, yielding an equivalence of categories
(Theorem \ref{thm.equivhypdccor}). This shows our decorated corelations
construction is as general as we need for the study of hypergraph categories,
and hence network-style diagrammatic languages.


\section{Decorated corelations} \label{sec:dcorc}

Decorating cospans requires more than just choosing a set of decorations for
each apex: for composition, we need to describe how these decorations transfer
along the copairing of pushout maps $[j_N,j_M]\maps N+M \to N+_YM$. Thus to
construct a decorated cospan category we need, as we have seen, not merely a
function from the objects of $\mc C$ to $\Set$, but a lax symmetric monoidal
functor $(\mc C,+) \to (\Set,\times)$. 

Similarly, decorating $(\mc E,\mc M)$-corelations requires still more
information: we now further need to know how to transfer decorations backwards along the
morphisms $N+_YM \xleftarrow{m} \overline{N+_YM}$. We thus introduce the
symmetric monoidal category $\mc C;\mc M^\opp$ with morphisms isomorphism
classes of cospans of the form $\xrightarrow{f}\xleftarrow{m}$, where $f \in \mc
C$ and $m \in \mc M$.  For constructing categories of decorated $(\mc E,\mc
M)$-corelations, we then require a lax symmetric monoidal functor $F$ from $\mc
C;\mc M^\opp$ to $\Set$. 

This section is structured in the same way as \textsection\ref{sec.corels}.
First, in \textsection\ref{ssec.rightads}, we introduce the categories $\mc
C;\mc M^\opp$, a prerequisite for the definition of decorated corelations. Next,
in \textsection\ref{ssec.deccorel}, we define decorated corelations, and then,
in \textsection\ref{ssec.deccorelcats} the hypergraph category of decorated
corelations. As in the previous chapter, we defer the proof that our hypergraph
category is a well-defined category until our discussion of functors in the
following section, \textsection\ref{sec.dcorf}.

\subsection{Adjoining right adjoints} \label{ssec.rightads}

Suppose we have a cospan $X+Y \to N$ with a decoration on $N$. Reducing this to
a corelation requires us to factor this to $X+Y \stackrel{e}\to \overline{N}
\stackrel{m}\to N$. To define a category of decorated corelations, then, we must
specify how to take decoration on $N$ and `pull it back' along $m$ to a decoration on
$\overline{N}$.

For decorated cospans, it is enough to have a functor $F$ from a category $\mc
C$ with finite colimits; the image $Ff$ of morphisms $f$ in $\mc C$ describes
how to move decorations forward along $f$. In this subsection we explain how to
expand $\mc C$ to include morphisms $m^\opp$ for each $m \in \mc C$, so that the
image $Fm^\opp$ of $m^\opp$ describes how to move morphisms backwards along $m$.
The construction of this expanded category $\mc C;\mc M^\opp$ is a simple
consequence of the stability of $\mc M$ under pushouts.

\begin{proposition}
  Let $\mathcal C$ be a category with finite colimits, and let $\mathcal M$ be a
  subcategory of $\mathcal C$ stable under pushouts. Then we define the category
  $\mathcal C; \mathcal M^\opp$ as follows  
  \smallskip 

  \begin{center}
    \begin{tabular}{| c | p{.65\textwidth} |}
      \hline
      \multicolumn{2}{|c|}{The symmetric monoidal category $(\mc C;\mc M^\opp,+)$} \\
      \hline
      \textbf{objects} & the objects of $\mathcal C$ \\ 
      \textbf{morphisms} & isomorphism classes of cospans of the form
      $\stackrel{c}\rightarrow \stackrel{m}\leftarrow$, where $c$ lies in
      $\mathcal C$ and $m$ in $\mathcal M$\\ 
      \textbf{composition} & given by pushout \\
      \textbf{monoidal product} & the coproduct in $\mathcal C$ \\
      \textbf{coherence maps} & the coherence maps in $\mc C$ \\
      \hline
    \end{tabular}
  \end{center}
  \smallskip 
\end{proposition}

\begin{proof}
  Our data is well defined: composition because $\mc M$ is stable under
  pushouts, and monoidal composition by Lemma \ref{lem.mcoproductsmc}. The
  coherence laws follow as this is a symmetric monoidal subcategory of
  $\cospan(\mc C)$. 
\end{proof}

\begin{remark}
As we state in the proof, the category $\mc C;\mc M^\opp$ is a subcategory of
$\cospan(\mc C)$. We can in fact view it as a sub-bicategory of the bicategory
of cospans in $\mc C$, where the 2-morphisms given by maps of cospans. In this
bicategory every morphism of $\mc M$ has a right adjoint.
\end{remark}

\begin{examples} 
  The factorisation systems introduced in Examples \ref{ex.factsysts} and
  considered again in Examples \ref{ex.corelcats} all have $\mc M$ stable under
  pushout. This yields the following examples.
  \begin{itemize}
    \item $\mathcal C; \mathcal C^\opp$ is by definition equal to
      $\cospan(\mathcal C)$.
    \item $\mathcal C;\mathcal I_{\mathcal C}^\opp$ is isomorphic to $\mathcal C$.
    \item $\Set;\mathrm{Inj}^\opp$ is the category with sets as objects and partial
      functions as morphisms.
  \end{itemize}
\end{examples}

The following lemma details how to construct functors between this type of
category.

\begin{lemma} \label{lem.madjointsfunctor}
  Let $\mathcal C$, $\mathcal C'$ be categories with finite colimits, and let
  $\mathcal M$, $\mathcal M'$ be subcategories of $\mc C$, $\mc C'$ respectively
  each stable under pushouts. Let $A\maps \mathcal C \to \mc C'$ be functor that
  preserves colimits and such that the image of $\mc M$ lies in $\mc M'$. Then
  $A$ extends to a symmetric strong monoidal functor
  \[
    A\maps \mc C;\mc M^\opp \longrightarrow \mc C'; \mc M'^\opp.
  \]
  mapping $X$ to $AX$ and $\stackrel{c}\rightarrow \stackrel{m}\leftarrow$ to
  $\stackrel{Ac}\rightarrow \stackrel{Am}\leftarrow$.
\end{lemma}
\begin{proof}
  Note $A(\mc M) \subseteq \mc M'$, so $\stackrel{Ac}\rightarrow
  \stackrel{Am}\leftarrow$ is indeed a morphism in $\mc C';\mc M'^\opp$. This is
  then a restriction and corestriction of the usual functor $\cospan(\mc C) \to
  \cospan(\mc C')$ to the above domain and codomain.
\end{proof}

Note that a similar construction giving subcategories of cospan categories could
be defined more generally using any two isomorphism-containing wide
subcategories stable under pushout.  The above, however, suffices for decorated
corelations.

\subsection{Decorated corelations} \label{ssec.deccorel}

As we have said, decorated corelations are constructed from a lax symmetric
monoidal functor from $\mc C;\mc M^\opp$ to $\Set$. In this subsection we define
decorated corelations and give a composition rule for them, showing that this
composition rule is well defined up to isomorphism.

\begin{definition}
  Let $\mathcal C$ be a category with finite colimits, $(\mathcal E, \mathcal
  M)$ be a factorisation system on $\mathcal C$ with $\mc M$ stable under
  pushout, and 
  \[
    F: (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\Set, \times)
  \]
  be a lax symmetric monoidal functor.  We define an $F$-\define{decorated
  corelation} to a pair
  \[
    \left(
    \begin{aligned}
      \xymatrix{
	& N \\  
	X \ar[ur]^{i} && Y \ar[ul]_{o}
      }
    \end{aligned}
    ,
    \qquad
    \begin{aligned}
      \xymatrix{
	FN \\
	1 \ar[u]_{s}
      }
    \end{aligned}
    \right)
  \]
  where the cospan is jointly $\mathcal E$-like. A morphism of decorated
  corelations is a morphism of decorated cospans between two decorated
  corelations.  As usual, we will be lazy about the distinction between a
  decorated corelation and its isomorphism class.
\end{definition}


Suppose we have decorated corelations
\[
  \left(
  \begin{aligned}
    \xymatrix{
      & N \\  
      X \ar[ur]^{i_X} && Y \ar[ul]_{o_Y}
    }
  \end{aligned}
  ,
  \qquad
  \begin{aligned}
    \xymatrix{
      FN \\
      1 \ar[u]_{s}
    }
  \end{aligned}
  \right)
  \qquad
  \mbox{and}
  \qquad
  \left(
  \begin{aligned}
    \xymatrix{
      & M \\  
      Y \ar[ur]^{i_Y} && Z \ar[ul]_{o_Z}
    }
  \end{aligned}
  ,
  \qquad
  \begin{aligned}
    \xymatrix{
      FM \\
      1 \ar[u]_{t}
    }
  \end{aligned}
  \right).
\]
Then, recalling the notation introduced in
\textsection\ref{ssec.corelcats}, their composite is given by the composite
corelation
\[
  \xymatrix{
    & \overline{N+_YM} \\  
    X \ar[ur]^{e\circ \iota_X} && Z \ar[ul]_{e \circ \iota_Z}
  }
\]
paired with the decoration
\[
  1 \xrightarrow{\varphi_{N,M}\circ\langle s,t\rangle} F(N+M)
  \xrightarrow{F[j_N,j_M]} F(N+_YM) \xrightarrow{F(m^\opp)} F(\overline{N+_YM}).
\]
As composition of corelations and decorated cospans are both well defined up to
isomorphism, this too is well defined up to isomorphism. 

\begin{proposition} \label{prop.deccorelcomp}
  Let $\mc C$ be a category with finite colimits and a factorisation system
  $(\mc E,\mc M)$ with $\mc M$ stable under pushout. Then the above is a
  well-defined composition rule on isomorphism classes of decorated corelations.
\end{proposition}
\begin{proof}
Let 
\[
  \big(X \stackrel{i_X}\longrightarrow N \stackrel{o_Y}\longleftarrow Y,\enspace 1
\stackrel{s}\longrightarrow FN\big) \stackrel\sim\longrightarrow \big(X \stackrel{i'_X}\longrightarrow N'
\stackrel{o'_Y}\longleftarrow Y,\enspace 1 \stackrel{s'}\longrightarrow FN'\big)
\]
and
\[
  \big(Y \stackrel{i_Y}\longrightarrow M \stackrel{o_Z}\longleftarrow Z,\enspace 1
\stackrel{t}\longrightarrow FM\big) \stackrel\sim\longrightarrow \big(Y \stackrel{i'_Y}\longrightarrow M'
\stackrel{o'_Z}\longleftarrow Z,\enspace 1 \stackrel{t'}\longrightarrow FM'\big)
\]
be isomorphisms of decorated corelations. We wish to show that the composite of the
decorated corelations on the left is isomorphic to the composite of the decorated
corelations on the right. 

As discussed in Proposition \ref{prop.deccorelcomp}, the composites of the
underlying corelations are isomorphic, via an isomorphism $s$ which exists by the
factorisation system. We need to show this $s$ is an isomorphism of decorations.
This is a matter of showing the diagram 
\[
    \xymatrixcolsep{3pc}
    \xymatrixrowsep{1pc}
 \xymatrix{
   && F(N+_YM) \ar[r]^{Fm^\opp} \ar[dd]_\sim^{Fp} & F(\overline{N+_YM})
   \ar[dd]_\sim^{Fs} \\
   1 \ar[urr]^(.4){F[j_N,j_M]\circ\varphi_{N,M}\circ \langle s,t \rangle\qquad}
   \ar[drr]_(.4){F[j_{N'},j_{M'}]\circ\varphi_{N',M'}\circ \langle s',t'
 \rangle\qquad\quad} \\
   && F(N'+_YM') \ar[r]_{Fm'^\opp} & F(\overline{N'+_YM'})\\
 }
\]
The triangle commutes as composition of decorated cospans is well defined
(Proposition \ref{prop.composingdeccospans}), while the square commutes as
composition of corelations is well defined (Proposition
\ref{prop.deccorelcomp}).
\end{proof}

\begin{remark}
  Note that we have chosen to define decorated corelations only for lax symmetric
  monoidal functors 
  \[
    (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\Set, \times),
  \]
  and not more generally for lax braided monoidal functors 
  \[
    (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\mc D, \otimes)
  \]
  for braided monoidal categories $\mc D$. While we could use the latter type of
  functor for our constructions, a similar arguments to those in Section
  \ref{sec.setdecs} show we gain no extra generality. On the other hand, keeping
  track of this possibly varying category $\mc D$ in the following distracts
  from the main insights. We thus merely remark that it is possible to make the
  more general definition, and leave it at that.
\end{remark}

\subsection{Categories of decorated corelations} \label{ssec.deccorelcats}

In this subsection we define the hypergraph category $F\mathrm{Corel}$ of
decorated corelations. Having defined decorated corelations and their
composition in the previous subsection, the key question to address is the
provenance of the monoidal and hypergraph structure. 

Recall, from \textsection\ref{ssec.corelcats}, that to define the monoidal and hypergraph
structure on categories of corelations, we used functors $\mathrm{Cospan}(\mc C)
\to \mathrm{Corel}(\mc C)$, leveraging the monoidal and hypergraph structure on
cospan categories. In analogy, here we leverage the same fact for decorated
cospans, this time using a structure preserving map 
\[
  \square\maps F\mathrm{Cospan} \longrightarrow F\mathrm{Corel}.
\]
Here $F\mathrm{Cospan}$ denotes the decorated cospan category constructed from
the restriction of the functor $F\maps \mc C;\mc M^\opp \to \Set$ to the domain
$\mc C$. 

The monoidal product of two decorated corelations is their monoidal product as
decorated cospans. To define the coherence maps for this monoidal product, as
well as the coherence maps, we introduce the notion of a restricted decoration.

Given a cospan $X \to N \leftarrow Y$, write $m\maps \overline{N} \to N$ for the
$\mc M$ factor of the copairing $X+Y \to N$. The map $\square$ takes a
decorated cospan 
\[
  (X \stackrel{i}\longrightarrow N \stackrel{o}\longleftarrow Y, \enspace 1
    \stackrel{s}\longrightarrow FN)
\]
to the decorated corelation 
\[
  (X \stackrel{\overline{i}}\longrightarrow \overline N
  \stackrel{\overline{o}}{\longleftarrow} Y, \enspace 1 \xrightarrow{Fm^\opp \circ
  s} F\overline{N}),
\]
where the corelation is given by the jointly $\mc E$-part of the cospan, and the
decoration is given by composing $s$ with the $F$-image $Fm^\opp\maps FN \to
F\overline{N}$ of the map $N \stackrel{1_N}\to N \stackrel{m}\leftarrow
\overline{N}$ in $\mc C;\mc M^\opp$. This is well-defined up to isomorphism of
decorated corelations. We call $Fm^\opp \circ s$ the \define{restricted
decoration} of the decoration on the cospan $(X \to N \leftarrow Y, \enspace 1
\stackrel{s}\to FN)$.

We then make the following definition.

\begin{theorem} \label{thm.fcorel}
  Let $\mathcal C$ be a category with finite colimits and factorisation system
  $(\mathcal E, \mathcal M)$ with $\mathcal M$ stable under pushout, and let 
  \[
    F: (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\Set, \times)
  \]
  be a lax symmetric monoidal functor.  Then we may define 
  \smallskip 

  \begin{center}
    \begin{tabular}{| c | p{.65\textwidth} |}
      \hline
      \multicolumn{2}{|c|}{The hypergraph category $(F\mathrm{Corel},+)$} \\
      \hline
      \textbf{objects} & the objects of $\mathcal C$ \\ 
      \textbf{morphisms} & isomorphism classes of $F$-decorated corelations in
      $\mathcal C$\\ 
      \textbf{composition} & given by $\mc E$-part of pushout with restricted
      decoration  \\
      \textbf{monoidal product} & the coproduct in $\mathcal C$  \\
      \textbf{coherence maps} & maps from $\cospan(\mc C)$ with restricted empty
      decoration \\
      \textbf{hypergraph maps} & maps from $\cospan(\mc C)$ with restricted empty
      decoration \\
      \hline
    \end{tabular}
  \end{center}
  \smallskip 
\end{theorem}

Similar to Theorem~\ref{thm.cospantocorel} defining the hypergraph category
$\corel(\mc C)$, we have now specified well-defined data and just need to check a
collection of coherence axioms. As before, we prove this in the next section,
alongside a theorem regarding functors between decorated corelation categories.

\begin{examples} \label{ex.cospansascorels}
  Recall that corelations with respect to the trivial \linebreak
  morphism--isomorphism factorisation system $(\mc C, \mc I_{\mc C})$ are simply
  cospans. Using this factorisation system, we see that decorated cospans are a
  special case of decorated corelations.
\end{examples}

\begin{example} \label{ex.undeccorel}
  `Undecorated' corelations are also a special case of decorated
  corelations: they are corelations decorated by the functor 
  \[
    1\maps \mc C;\mc M^\opp \to \Set
  \] 
  that maps each object to the one element set $1$, and each morphism to the
  identity function on $1$. This is a symmetric monoidal functor with the
  coherence maps all also the identity function on $1$.
\end{example}


%Associativity: To take a decoration on $A+B$ to one on $A+_C\overline B$ we may
%either reduce to the $\mathcal E$-part of $B$ and then pushout over $C$, or
%pushout over $C$ and then reduce to the $\mathcal E$ part of $B$. This lemma
%implies that both processes result in the same decoration.  i

\section{Functors between decorated corelation categories} \label{sec.dcorf}
In this section we show how to construct hypergraph functors between decorated
corelation categories. The construction of these functors holds no surprises:
their requirements combine the requirements of corelations and decorated
cospans. In the process of proving that our construction gives well-defined
hypergraph functors, we complete the necessary prerequisite proof that decorated
corelation categories are well-defined hypergraph categories.

Recall that Lemma \ref{lem.madjointsfunctor} says that, when the image of $\mc
M$ lies in $\mc M'$, we can extend a colimit-preserving functor $\mc C \to \mc
C'$ to a symmetric monoidal functor $\mc C;\mc M^\opp \to \mc C';\mc M'^\opp$ .

\begin{proposition}\label{prop.deccorelfunctors}
  Let $\mathcal C$, $\mathcal C'$ have finite colimits and respective
factorisation systems $(\mathcal E, \mathcal M)$, $(\mathcal E', \mathcal M')$,
such that $\mathcal M$ and $\mathcal M'$ are stable under pushout, and suppose
that we have lax symmetric monoidal functors
\[
  F: (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\Set, \times)
\]
and
\[
  G: (\mathcal C';\mathcal M'^\opp,+) \longrightarrow (\Set, \times).
\]

Further let $A\maps \mathcal C \to \mathcal C'$ be a functor that preserves
finite colimits and such that the image of $\mathcal M$ lies in $\mathcal M'$.
This functor $A$ extends to a symmetric monoidal functor $\mc C;\mc M^\opp \to
\mc C';\mc M'^\opp$.

Suppose we have a monoidal natural transformation $\theta$:
\[
  \xymatrixrowsep{2ex}
  \xymatrix{
    \mc C; \mc M^\opp \ar[dd]_{A} \ar[drr]^F  \\
    &\twocell \omit{_\:\theta}& \Set \\
    \mc C'; \mc {M'}^\opp \ar[urr]_{G} 
  }
\]

Then we may define a hypergraph functor $T\maps F\mathrm{Corel} \to
G\mathrm{Corel}$ sending each object $X \in F\mathrm{Corel}$ to $AX \in
G\mathrm{Corel}$ and each decorated corelation 
  \[
    \left(
    \begin{aligned}
      \xymatrix{
	& N \\  
	X \ar[ur]^{i} && Y \ar[ul]_{o}
      }
    \end{aligned}
    ,
    \qquad
    \begin{aligned}
      \xymatrix{
	FN \\
	1 \ar[u]_{s}
      }
    \end{aligned}
    \right)
  \]  
to
  \[
    \left(
    \begin{aligned}
      \xymatrix{
	& \overline{AN} \\  
	AX \ar[ur]^{e'\circ\iota_{AX}} && AY \ar[ul]_{e'\circ\iota_{AY}}
      }
    \end{aligned}
    ,
    \qquad
    \begin{aligned}
      \xymatrixrowsep{1.5ex}
      \xymatrix{
	G\overline{AN} \\
	GAN \ar[u]_{Gm_{AN}^\opp}\\
        FN \ar[u]_{\theta_N}\\
	1 \ar[u]_{s}
      }
    \end{aligned}
    \right)
  \]  
  The coherence maps $\overline{\kappa_{X,Y}}$ are given by the coherence maps of
  $A$ with the restricted empty decoration.
\end{proposition}
\begin{proof}[Proof of Theorem \ref{thm.fcorel} and Proposition
  \ref{prop.deccorelfunctors}]
  In the proof of Theorem \ref{thm.cospantocorel} and Proposition
  \ref{prop.corelfunctors} we proved that the map 
  \[
    \square\maps \corel(\mc C) \longrightarrow \corel(\mc C')
  \]
  preserved composition and had natural coherence maps. Specialising to the case
  when $\corel(\mc C)=\cospan(\mc C')$, we saw that this bijective-on-objects,
  surjective-on-morphisms, composition and monoidal product preserving map
  proved $\corel(\mc C')$ is a hypergraph category, and it immediately followed
  that $\square$ is a hypergraph functor.

  The analogous argument holds here: we simply need to prove
  \[
    \square\maps F\corel \longrightarrow G\corel
  \]
  preserves composition and has natural coherence maps. Theorem \ref{thm.fcorel}
  then follows from examining the map $F\cospan \to F\corel$ obtained by
  choosing $\mc C = \mc C'$, $(\mc E,\mc M) = (\mc C', \mc I_{\mc C'})$, $F$ the
  restriction of $G$ to $\mc C'$, $A$ the identity functor on $\mc C'$, and
  $\theta$ the identity natural transformation. Subsequently Proposition
  \ref{prop.deccorelfunctors} follows from noting that all the axioms hold for
  the corresponding maps in $G\mathrm{Cospan}$.
  
  \paragraph{$\square$ preserves composition.} Suppose we have decorated corelations
  \[
    f=(X \stackrel{i_X}{\longrightarrow} N \stackrel{o_Y}{\longleftarrow} Y,
    \enspace 1 \stackrel{s}{\to} FN)
    \qquad
    \mbox{and}
    \qquad 
    g=(Y \stackrel{i_Y}{\longrightarrow} M \stackrel{o_Y}{\longleftarrow} Z,
    \enspace 1 \stackrel{t}{\to} FM)
  \]
%  \[
%    \left(
%    \begin{aligned}
%      \xymatrix{
%	& N \\  
%	X \ar[ur]^{i} && Y \ar[ul]_{o}
%      }
%    \end{aligned}
%    ,
%    \qquad
%    \begin{aligned}
%      \xymatrix{
%	FN \\
%	1 \ar[u]_{s}
%      }
%    \end{aligned}
%    \right)
%    \qquad
%    \mbox{and}
%    \qquad
%    \left(
%    \begin{aligned}
%      \xymatrix{
%	& M \\  
%	Y \ar[ur]^{i} && Z \ar[ul]_{o}
%      }
%    \end{aligned}
%    ,
%    \qquad
%    \begin{aligned}
%      \xymatrix{
%	FM \\
%	1 \ar[u]_{s}
%      }
%    \end{aligned}
%    \right).
%  \]
  We know the functor $\square$ preserves composition on the cospan part; this
  is precisely the content of Proposition \ref{prop.corelfunctors}. It remains to
  check that $\square( g \circ f)$ and $\square g \circ \square f$ have
  isomorphic decorations. This is expressed by the commutativity of the
  following diagram:
  \[
    \xymatrixrowsep{1.1pc}
    \xymatrixcolsep{.6pc}
    \xymatrix{
      \scriptstyle G\overline{A(\overline{N+_YM})} \ar[rrrrrr]^{Gn} &&&&&&
      \scriptstyle G\overline{(\overline{AN}+_{AY}\overline{AM})}\\
      \\
      \scriptstyle GA(\overline{N+_YM}) \ar[uu]^{Gm^\opp_{A(\overline{N+_YM})}} &&&
      \textsc{\tiny($\ast\ast$)} &&& 
      \scriptstyle G(\overline{AN}+_{AY}\overline{AM})
      \ar[uu]_{Gm^\opp_{\overline{AN}+_{AY}\overline{AM}}} \\
      \\
      \scriptstyle F(\overline{N+_YM}) \ar[uu]^{\theta_{\overline{N+_YM}}} &
      %\textsc{\tiny()} & 
      &
      \scriptstyle GA(N+_YM) \ar[uull]_{GAm^\opp_{N+_YM}} && 
      \scriptstyle G(AN+_{AY}AM) \ar[ll]_{G\sim} \ar[uurr]^{G(m_{AN}^\opp
      +_{AY}m_{AM}^\opp)\phantom{spac}}
      & \textsc{\tiny(c)} & 
      \scriptstyle G(\overline{AN}+\overline{AM})
      \ar[uu]_{G[j_{\overline{AN}},j_{\overline{AM}}]} 
      \\
      &\textsc{\tiny(tn)}&& \textsc{\tiny(a)} 
      \\
      \scriptstyle F(N+_YM) \ar[uu]^{Fm_{N+_YM}^\opp}
      %\ar[uurr]_{\theta_{N+_YM}} & \textsc{\tiny()} & 
      &&
      \scriptstyle GA(N+M)\ar[uu]_{GA[j_N,j_M]} && 
      \scriptstyle G(AN+AM) \ar[uu]^{G[j_{AN},j_{AM}]} \ar[ll]^{G\alpha_{N,M}}
      \ar[uurr]^(.6){G(m_{AN}^\opp +m_{AM}^\opp)\phantom{s}} & \textsc{\tiny(gm)} & 
      \scriptstyle G\overline{AN} \times G\overline{AM}
      \ar[uu]_{\gamma_{\overline{AN},\overline{AM}}} \\
      \\
      \scriptstyle F(N+M) \ar[uu]^{F[j_N,j_M]} \ar[uurr]_{\theta_{N+M}} &&&
      \textsc{\tiny(tm)} &&& 
      \scriptstyle GAN \times GAM \ar[uu]_{Gm_{AN}^\opp \times Gm_{AM}^\opp}
      \ar[uull]^{\gamma_{AN,AM}} \\
      \\
      &&&
      \scriptstyle FN \times FM \ar[uulll]^{\varphi_{N,M}}
      \ar[uurrr]_{\theta_N \times \theta_M} \\\\
      &&&
      \scriptstyle 1 \ar[uu]_{\rho_1\circ (s \times t)}
    }
  \]
  This diagram does indeed commute. To check this, first observe that \textsc{(tm)}
  commutes by the monoidality of $\theta$, \textsc{(gm)} commutes by the
  monoidality of $G$, and \textsc{(tn)} commutes by the naturality of $\theta$.
  The remaining three diagrams commute as they are $G$-images of diagrams that
  commute in $\mc C';\mc M'^\opp$. Indeed, \textsc{(a)} commutes since $A$ preserves
  colimits and $G$ is functorial, \textsc{(c)} commutes as it is the $G$-image
  of a pushout square in $\mc C'$, so 
  \[
    \xleftarrow{m_{AN}+m_{AM}}
    \xrightarrow{[j_{\overline{AN}},j_{\overline{AM}}]}
    \quad 
    \textrm{and}
    \quad
    \xrightarrow{[j_{AN},j_{AM}]}
    \xleftarrow{m_{AN}+_{AY}m_{AM}} 
  \]
  are equal as morphisms of $\mc C';\mc M'^\opp$, and \textsc{($\ast\ast$)}
  commutes as it is the $G$-image of the right-hand subdiagram of
  (\ref{diag.eparts}) used to define $n$ in the proof of Lemma
  \ref{lem.corelfuncomposition}.

  \paragraph{Coherence maps are natural.}
  Let $f = (X \longrightarrow N \longleftarrow Y, \enspace 1 \to FN)$, $g= (Z
  \longrightarrow M \longleftarrow W, \enspace 1 \to FM)$ be $F$-decorated
  corelations in $\mc C$. We wish to show that
  \[
    \xymatrixcolsep{4pc}
    \xymatrixrowsep{2pc}
    \xymatrix{
      AX+AY \ar[r]^{\square f+\square g}
      \ar[d]_{\overline{\kappa_{X,Y}}} & 
      AZ+AW \ar[d]^{\overline{\kappa_{Z,W}}} \\
      A(X+Y) \ar[r]^{\square(f+g)} & A(Z+W)
    }
  \]
  commutes in $G\mathrm{Corel}$, where the coherence maps are given by
  \[
    \overline{\kappa_{X,Y}}=          
    \left(
    \begin{aligned}
      \xymatrix{
	& \overline{A(X+Y)} \\  
	AX+AY \ar[ur] && A(X+Y) \ar[ul]
      }
    \end{aligned}
    ,
    \qquad
    \begin{aligned}
      \xymatrixrowsep{1.4ex}
      \xymatrix{
	G(\overline{A(X+Y)}) \\
	GA(X+Y) \ar[u]_{Gm_{AX+AY}^\opp} \\
	G\varnothing \ar[u]_{G!} \\
	1 \ar[u]_{\gamma_1}
      }
    \end{aligned}
    \right).
  \]
  Lemma \ref{lem.corelfunmonoidal} shows that the composites of corelations
  agree. It remains to check that the decorations also agree.

  Here Lemma \ref{lem.emptydecorations} is helpful. Since $\square$ is
  composition preserving, we can replace the $\overline{\kappa}$ with the empty
  decorated coherence maps $\kappa$ of $G\mathrm{Cospan}$, and compute these
  composites in $G\mathrm{Cospan}$, before restricting to the $\mc E'$-parts.
  Lemma \ref{lem.emptydecorations} then implies that the restricted empty
  decorations on the isomorphisms $\overline{\kappa}$ play no role in
  determining the composite decorations. It is thus enough to prove that the
  decorations of $\square f + \square g$ and $\square(f+g)$ are the same up to
  the isomorphism $p\maps G(\overline{AN} +\overline{AM}) \to
  G\overline{A(N+M)}$ between their apices, as defined in the diagram
  (\ref{diag.natural}) in the proof of Lemma \ref{lem.corelfunmonoidal}.

  This comes down to proving the following diagram commutes:
  \[
    \xymatrixrowsep{.8pc}
    \xymatrixcolsep{.8pc}
    \xymatrix{
      &&&& 
      GAN \times GAM \ar[rrdd]^{\gamma} \ar[rr]^{Gm \times Gm} && 
      G\overline{AN} \times G\overline{AM} \ar[rr]^{\gamma} && 
      G(\overline{AN}+\overline{AM}) \ar[dddd]^{Gp}_\sim \\ 
      &&&&&& 
      \textrm{\tiny(G)} \\
      1 \ar[rr]^(.4){\langle s,t \rangle} && 
      FN\times FM \ar[uurr]^{\theta} \ar[ddrr]_{\varphi} && 
      \textrm{\tiny(T)} && 
      G(AN+AM) \ar[uurr]^{G(m+m)} \ar[dd]_{G\kappa} \\
      &&&&&&& 
      \textrm{\tiny(\#\#)}\\ 
      &&&& 
      F(N+M) \ar[rr]_{\theta} && 
      GA(N+M) \ar[rr]_{Gm} && 
      G\overline{A(N+M)}
    }
  \]
  This is straightforward to check: (T) commutes by the monoidality of $\theta$,
  (G) by the monoidality of $G$, and (\#\#) as it is the $G$-image of the
  rightmost square in (\ref{diag.natural}).
\end{proof}

In particular, we get a hypergraph functor from the category of $F$-decorated
cospans to the category of $F$-decorated corelations. In our applications, this
is often the key aspect of constructing `black box' or semantic functors.

%  \[
%    \xymatrixrowsep{1pc}
%    \xymatrixcolsep{1pc}
%    \xymatrix{
%      &&&& F(N+M) \ar[dd]^{F((m_N +m_M)^\opp)} \ar[rr]^{F[j_N,j_M]} 
%      && F(N+_YM) \ar[dd]^{F((m_N+_Ym_M)^\opp)} \ar[rr]^{F((m_{N+_YM})^\opp)} 
%      && F(\overline{N+_YM}) \ar[dd]^{Fn}_\sim \\ 
%      1 \ar[rr]^(.4){(s\times t)\circ\lambda^{-1}} 
%      && FN\times FM \ar[urr]^{\varphi} \ar[dr]_{Fm_N^\opp\times Fm_M^\opp} &
%      \qquad\textrm{\tiny(I)}% && \textrm{\tiny(F)} && \textrm{\tiny(C)}
%      \\ 
%      &&& F\overline{N} \times F\overline{M} \ar[r]_{\varphi} 
%      & F(\overline{N}+\overline{M})
%      \ar[rr]_{F[j_{\overline{N}},j_{\overline{M}}]} 
%      && F(\overline{N}+_Y\overline{M})
%      \ar[rr]_{F((m_{\overline{N}+_Y\overline{M}})^\opp)} 
%      && F(\overline{\overline{N}+_Y\overline{M}})
%    }
%  \]
%  Here $n$ is the isomorphism from the proof of Proposition
%  \ref{prop.corelfunctors}.
%  The leftmost square (I) commutes by the naturality of $\varphi$, the central
%  square commutes as it is the $F$-image of a pushout square in $\mathcal C$,
%  and rightmost square commutes as it is the $F$-image of the rightmost square
%  in the commutative diagram (\ref{diag.eparts}) in $\mathcal M^\opp$.
  


\begin{corollary}
  Let $\mathcal C$ be a category with finite colimits, and let $(\mathcal E,
  \mathcal M)$ be a factorisation system on $\mathcal C$. Suppose that we also
  have a lax monoidal functor
  \[
    F: (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\Set, \times).
  \]
  Then we may define a category $F\mathrm{Corel}$ with objects the objects of
  $\mathcal C$ and morphisms isomorpism classes of $F$-decorated corelations.

  Write also $F$ for the restriction of $F$ to the wide subcategory $\mathcal
  C$ of $\mathcal C;\mathcal M^\opp$. We can thus also obtain the category
  $F\mathrm{Cospan}$ of
  $F$-decorated cospans. We moreover have a functor 
  \[
    F\mathrm{Cospan} \to F\mathrm{Corel}
  \]
  which takes each object of $F\mathrm{Cospan}$ to itself as an object of
  $F\mathrm{Corel}$, and each decorated cospan
  \[
    \left(
    \begin{aligned}
      \xymatrix{
	& N \\  
	X \ar[ur]^{i} && Y \ar[ul]_{o}
      }
    \end{aligned}
    ,
    \qquad
    \begin{aligned}
      \xymatrix{
	FN \\
	1 \ar[u]_{s}
      }
    \end{aligned}
    \right)
  \]  
  to its jointly $\mathcal E$-part
  \[
    \xymatrix{
      & \overline{N} \\  
      X \ar[ur]^{e\circ \iota_X} && Y \ar[ul]_{e\circ\iota_Y}
    }
  \]
  decorated by the composite
  \[
    \xymatrix{
      1 \ar[r]^s & FN \ar[r]^{Fm_N^\opp} & F\overline{N}.
    }
  \]
\end{corollary}


\section{All hypergraph categories are decorated corelation categories}
\label{sec.allhypergraphs}

Not all hypergraph categories are decorated \emph{cospan} categories. To see
this, we can count so-called scalars: morphisms from the monoidal unit
$\varnothing$ to itself. In a decorated cospan category, the set of morphisms
from $X$ to $Y$ always comprises all decorated cospans $(X \to N \leftarrow
Y,\enspace 1 \to FN)$. Now for any object $N$ in the underlying category $\mc
C$, there is a unique morphism $\varnothing \to N$. This means that the
morphisms $\varnothing \to \varnothing$ are indexed by (isomorphism classes of)
elements of $FN$, ranging over $N$.

Suppose we have a decorated cospan category with a unique morphism $\varnothing
\to \varnothing$. By the previous paragraph, and replacing $\mc C$ with an
equivalent skeletal category, this implies there is only one object $N$ such
that $FN$ is nonempty. But $FN$ must always contain at least one element, the
empty decoration $1 \xrightarrow{\varphi_I} F\varnothing \xrightarrow{F!} FN$.
This implies there is only one object $N$ in $\mc C$: the object $\varnothing$.
Thus $\mc C$ must be the one object discrete category, and $F\maps \mc C \to
\Set$ is the functor that sends the object of $\mc C$ to the one element set
$1$.

Hence any decorated cospan category with a unique morphism $\varnothing \to
\varnothing$ is the one object discrete category. But the hypergraph
category of finite sets and equivalence relations, discussed in Subsection
\ref{ssec.equivrels}, is a nontrivial category with a unique morphism
$\varnothing \to \varnothing$.  Thus it cannot be constructed as a decorated
cospan category.

Decorated corelation categories, however, are more powerful. In this section we
show that all hypergraph categories are decorated corelation categories, and
provide some examples for intuition.

\subsection{Representing a morphism with its name}
Suppose we are given a hypergraph category $\mc H$ and wish to construct a
hypergraph equivalent decorated corelation category. The main idea to is to take
advantage of the compact closed structure: recall from
\textsection\ref{ssec.compactclosed} that morphisms $X \to Y$ in a hypergraph
category are in one-to-one correspondence with their so-called names $I \to X\ot
Y$. We shall also witness the great utility of the seemingly trivial
isomorphism-morphism factorisation system. 

We start with the wide subcategory of $\mc H$ comprising, roughly speaking, just
the coherence and hypergraph maps. Then, choosing the isomorphism-morphism
factorisation system on this subcategory, we use the restriction of hom functor
$\mc H(I,-)$ to this subcategory to decorate each corelation $X \to X \ot Y
\leftarrow Y$ with the monoidal elements of $X\ot Y$.  The morphisms in the
resulting category are cospans $X \xrightarrow{1_X \otimes \eta_Y} X\otimes Y
\xleftarrow{\eta_X \otimes 1_Y} Y$ decorated by a map $I \to X \ot Y$. This
recovers the original hypergraph category.


\begin{theorem}\label{thm.hypdeccorcats}
  Every hypergraph category is hypergraph equivalent to a decorated corelation
  category. That is, given a hypergraph category $(\mc H,\otimes)$, there exists
  a lax symmetric monoidal functor $F$ such that $(\mc H,\otimes)$ is hypergraph
  equivalent to $F\mathrm{Corel}$.
\end{theorem}
\begin{proof}
  Let $(\mc H,\ot)$ be a hypergraph category. By Theorem
  \ref{thm.stricthypergraphs}, we have a hypergraph equivalent strict hypergraph
  category $(\mc H_{\mathrm{str}},\cdot)$ with objects finite lists of objects
  in $\mc H$. We will build $\mc H_{\mathrm{str}}$ as a decorated corelation
  category.

  Write $\mc O$ for the collection of objects in $\mc H$.  Recall that we may
  write $\FinSet$ for the skeletal strict symmetric monoidal category of finite
  sets and functions, and here let us further denote the objects of $\FinSet$ as
  $n= \{0,1,\dots,n-1\}$ for $n \in \mathbb N$, where $0$ is the empty set. We
  then write $\FinSet_{\mc O}$ for the category of $\mc O$-labelled finite sets
  (i.e.  an object is a finite set $n$ with each element in $n$ labelled by some
  object in $\mc H$, and a morphism is a function that preserves labels). Note
  that, due to the chosen ordering on elements of each finite set $n$, the
  objects of $\FinSet_{\mc O}$ are in one-to-one correspondence with finite
  lists of objects of $\mc H$, and hence can be considered the same as the
  objects of $\mc H_{\mathrm{str}}$.
  
  Next, observe that the category $\FinSet_{\mc O}$ has finite colimits: the
  colimit is just the colimit set in $\FinSet$ with each element labelled by the
  label of any element that maps to it in the colimit diagram. This labelling
  exists and is unique by the universal property of the colimit. Thus we view
  $\FinSet_{\mc O}$ as a symmetric monoidal category with the coproduct, written
  $+$ as per usual, as its monoidal product.  

  We define a strict hypergraph functor that is a wide embedding of categories
  \[
    H\maps (\cospan(\FinSet_{\mc O}),+) \longrightarrow (\mc
    H_{\mathrm{str}},\cdot),
  \]
  whose image is the hypergraph structure of $\mc H_{\mathrm{str}}$. More
  precisely, $H$ sends each object of $\cospan(\FinSet_{\mc O})$ to the same as
  an object of $\mc H_{\mathrm{str}}$.  As the morphisms of $\FinSet$---that is,
  all functions between finite sets---can be generated via composition and
  coproduct from the unique functions $\mu \maps 2 \to 1$, $\eta \maps 0 \to 1$,
  and the braiding $2 \to 2$ in $\FinSet$, the morphisms of $\FinSet_{\mc O}$
  are generated as a symmetric monoidal category by the unique morphisms
  $\mu_x\maps [x:x]\to [x]$ and $\eta_x\maps \varnothing \to [x]$, where $x$
  ranges over objects of $\mc H$.  This then implies the morphisms of
  $\cospan(\FinSet_{\mc O})$ are generated as a symmetric monoidal category by
  the cospans $\mu_x$, $\eta_x$, $\delta_x = \mu_x^\opp$, and $\epsilon_x =
  \eta_x^\opp$. The functor $H$ maps these generators to the corresponding
  Frobenius maps on $[x]$ in $\mc H_{\mathrm{str}}$. Since $\cospan(\FinSet)$ is
  the `generic special commutative monoid' (see Proposition
  \ref{prop.cospanscfm}), it is straightforward to check this defines a
  hypergraph functor.

  Next, recall that the hom functor $\mc H_{\mathrm{str}}(I,-)\maps (\mc
  H_{\mathrm{str}},\cdot) \to (\Set,\times)$ is a lax symmetric monoidal functor taking each
  object $X$ of $\mc H_{\mathrm{str}}$ to the homset $\mc H_{\mathrm{str}}(I,X)$
  (Proposition \ref{prop.monglobalsecs}). Write $F$ for the composite of these
  two functors: 
  \[
    F\maps (\cospan(\FinSet_{\mc O}),+) \stackrel{H}\longrightarrow (\mc
    H_{\mathrm{str}},\cdot) \xrightarrow{\mc H_{\mathrm{str}}(I,-)}
    (\Set,\times).
  \]
  This is lax symmetric monoidal functor mapping a finite list $X$ of objects in
  $\mc H$ to the homset $\mc H_{\mathrm{str}}(I,X)$, and a cospan between lists
  of objects in $\mc H$ to the corresponding Frobenius map.

  Now consider $\FinSet_{\mc O}$ with an isomorphism-morphism factorisation
  system. This implies $F$ defines a decorated corelation category
  $F\mathrm{Corel}$ with the objects of $\mc H_{\mathrm{str}}$ as objects, and
  the unique isomorphism-morphism corelation $X \xrightarrow{\iota_X} X+Y
  \xleftarrow{\iota_Y} Y$ from $X \to Y$ decorated by some morphism $s \in \mc
  H_{\mathrm{str}}(I,X\cdot Y)$ as morphisms $X \to Y$. We complete this proof
  by showing $(F\mathrm{Corel},+)$ and $(\mc H_{\mathrm{str}},\cdot)$ are
  isomorphic as hypergraph categories.
  
  First, let us examine composition in $F\mathrm{Corel}$. As morphisms $X \to Y$
  are completely specified by their decoration $s \in \mc
  H_{\mathrm{str}}(I,X\cdot Y)$, we will abuse terminology and refer to the
  decorations themselves as the morphisms.  Given morphisms $s \in \mc
  H_{\mathrm{str}}(I,X\cdot Y)$ and $t \in \mc H_{\mathrm{str}}(I,Y\cdot Z)$ in
  $F\mathrm{Corel}$, composition is given by the map 
  \[
    H_{\mathrm{str}}(I,X\cdot Y\cdot Y\cdot Z) \to H_{\mathrm{str}}(I,X\cdot Z)
  \]
  arising as the $F$-image of the cospan $X+Y+Y+Z
  \xrightarrow{[j_{X+Y},j_{Y+Z}]} X+Y+Z \xleftarrow{[\iota_X,\iota_Z]} X+Z$,
  where these maps come from the pushout square
  \[
    \xymatrix{
      && X+Y+Z \\
      & X+Y \ar[ur]^{j_{X+Y}} && Y+Z \ar[ul]_{j_{Y+Z}} \\
      X \ar[ur]^{\iota_X} && Y \ar[ul]_{\iota_Y} \ar[ur]^{\iota_Y} && Z
      \ar[ul]_{\iota_Z}
    }
  \]
  and the trivial isomorphism-morphism factorisation $X+Z = X+Z
  \xrightarrow{[\iota_X,\iota_Z]} X+Y+Z$ in $\FinSet_{\mc O}$.
  
  In terms of string diagrams in $\mc H_{\mathrm{str}}$, this means composing
  the maps 
  \[
    \tikzset{every path/.style={line width=1.1pt}}
    \begin{tikzpicture}
      \begin{pgfonlayer}{nodelayer}
	\node [style=none] (0) at (-0.25, 0.375) {};
	\node [style=none] (1) at (0.5, 0.375) {};
	\node [style=none] (2) at (-0.25, -0.375) {};
	\node [style=none] (3) at (0.5, -0.375) {};
	\node [style=none] (4) at (0.5, 0.25) {};
	\node [style=none] (5) at (0.5, -0.25) {};
	\node [style=none] (6) at (1.25, 0.25) {};
	\node [style=none] (7) at (1.25, -0.25) {};
	\node [style=none] (8) at (0.125, -0) {$s$};
	\node [style=none] (9) at (1.5, 0.25) {$X$};
	\node [style=none] (10) at (1.5, -0.25) {$Y$};
      \end{pgfonlayer}
      \begin{pgfonlayer}{edgelayer}
	\draw (0.center) to (1.center);
	\draw (1.center) to (3.center);
	\draw (3.center) to (2.center);
	\draw (2.center) to (0.center);
	\draw (4.center) to (6.center);
	\draw (5.center) to (7.center);
      \end{pgfonlayer}
    \end{tikzpicture}
    \qquad 
    \qquad
    \begin{tikzpicture}
      \begin{pgfonlayer}{nodelayer}
	\node [style=none] (0) at (-0.25, 0.375) {};
	\node [style=none] (1) at (0.5, 0.375) {};
	\node [style=none] (2) at (-0.25, -0.375) {};
	\node [style=none] (3) at (0.5, -0.375) {};
	\node [style=none] (4) at (0.5, 0.25) {};
	\node [style=none] (5) at (0.5, -0.25) {};
	\node [style=none] (6) at (1.25, 0.25) {};
	\node [style=none] (7) at (1.25, -0.25) {};
	\node [style=none] (8) at (0.125, -0) {$t$};
	\node [style=none] (9) at (1.5, 0.25) {$Y$};
	\node [style=none] (10) at (1.5, -0.25) {$Z$};
      \end{pgfonlayer}
      \begin{pgfonlayer}{edgelayer}
	\draw (0.center) to (1.center);
	\draw (1.center) to (3.center);
	\draw (3.center) to (2.center);
	\draw (2.center) to (0.center);
	\draw (4.center) to (6.center);
	\draw (5.center) to (7.center);
      \end{pgfonlayer}
    \end{tikzpicture}
  \]
  with the Frobenius map
  \[
    \tikzset{every path/.style={line width=1.1pt}}
    \begin{aligned}
      \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
	  \node [style=none] (0) at (-0.125, 0.75) {};
	  \node [style=none] (1) at (-0.125, 0.25) {};
	  \node [style=none] (2) at (-0.125, -0.25) {};
	  \node [style=none] (3) at (-0.125, -0.75) {};
	  \node [style=none] (4) at (0.5, -0) {};
	  \node [style=none] (5) at (1, 0.75) {};
	  \node [style=none] (6) at (1, -0.75) {};
	  \node [style=none] (8) at (-0.375, 0.75) {$X$};
	  \node [style=none] (9) at (-0.375, 0.25) {$Y$};
	  \node [style=none] (10) at (-0.375, -0.25) {$Y$};
	  \node [style=none] (11) at (-0.375, -0.75) {$Z$};
	  \node [style=none] (12) at (1.25, 0.75) {$X$};
	  \node [style=none] (13) at (1.25, -0.75) {$Z$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	  \draw (0.center) to (5.center);
	  \draw [in=90, out=0, looseness=1.00] (1.center) to (4.center);
	  \draw [in=-90, out=0, looseness=1.00] (2.center) to (4.center);
	  \draw (3.center) to (6.center);
	\end{pgfonlayer}
      \end{tikzpicture}
    \end{aligned}
    \quad
    =
    \quad
    \begin{aligned}
      \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
	  \node [style=none] (0) at (-0.125, 0.75) {};
	  \node [style=none] (1) at (-0.125, 0.25) {};
	  \node [style=none] (2) at (-0.125, -0.25) {};
	  \node [style=none] (3) at (-0.125, -0.75) {};
	  \node [style=none] (4) at (0.5, -0) {};
	  \node [style=none] (5) at (1.25, 0.75) {};
	  \node [style=none] (6) at (1.25, -0.75) {};
	  \node [style=circ2] (7) at (1, -0) {};
	  \node [style=none] (8) at (-0.375, 0.75) {$X$};
	  \node [style=none] (9) at (-0.375, 0.25) {$Y$};
	  \node [style=none] (10) at (-0.375, -0.25) {$Y$};
	  \node [style=none] (11) at (-0.375, -0.75) {$Z$};
	  \node [style=none] (12) at (1.5, 0.75) {$X$};
	  \node [style=none] (13) at (1.5, -0.75) {$Z$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	  \draw (0.center) to (5.center);
	  \draw [in=90, out=0, looseness=1.00] (1.center) to (4.center);
	  \draw [in=-90, out=0, looseness=1.00] (2.center) to (4.center);
	  \draw (3.center) to (6.center);
	  \draw (4.center) to (7.center);
	\end{pgfonlayer}
      \end{tikzpicture}
    \end{aligned}
  \]
  to get 
  \[
    \tikzset{every path/.style={line width=1.1pt}}
    \begin{aligned}
      \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
	  \node [style=none] (0) at (-0.25, 0.375) {};
	  \node [style=none] (1) at (0.5, 0.375) {};
	  \node [style=none] (2) at (-0.25, -0.375) {};
	  \node [style=none] (3) at (0.5, -0.375) {};
	  \node [style=none] (4) at (0.5, 0.25) {};
	  \node [style=none] (5) at (0.5, -0.25) {};
	  \node [style=none] (6) at (1.25, 0.25) {};
	  \node [style=none] (7) at (1.25, -0.25) {};
	  \node [style=none] (8) at (0.125, -0) {$t\circ s$};
	  \node [style=none] (9) at (1.5, 0.25) {$X$};
	  \node [style=none] (10) at (1.5, -0.25) {$Z$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	  \draw (0.center) to (1.center);
	  \draw (1.center) to (3.center);
	  \draw (3.center) to (2.center);
	  \draw (2.center) to (0.center);
	  \draw (4.center) to (6.center);
	  \draw (5.center) to (7.center);
	\end{pgfonlayer}
      \end{tikzpicture}
    \end{aligned}
    \quad = 
    \quad
    \begin{aligned}
      \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
	  \node [style=none] (0) at (-0.875, 0.875) {};
	  \node [style=none] (1) at (-0.125, 0.875) {};
	  \node [style=none] (2) at (-0.125, 0.125) {};
	  \node [style=none] (3) at (-0.875, 0.125) {};
	  \node [style=none] (4) at (-0.875, -0.125) {};
	  \node [style=none] (5) at (-0.125, -0.125) {};
	  \node [style=none] (6) at (-0.125, -0.875) {};
	  \node [style=none] (7) at (-0.875, -0.875) {};
	  \node [style=none] (8) at (-0.125, 0.75) {};
	  \node [style=none] (9) at (-0.125, 0.25) {};
	  \node [style=none] (10) at (-0.125, -0.25) {};
	  \node [style=none] (11) at (-0.125, -0.75) {};
	  \node [style=none] (12) at (0.5, -0) {};
	  \node [style=none] (13) at (0.75, 0.75) {};
	  \node [style=none] (14) at (0.75, -0.75) {};
	  \node [style=none] (15) at (-0.5, 0.5) {$s$};
	  \node [style=none] (16) at (-0.5, -0.5) {$t$};
	  \node [style=none] (17) at (1, 0.75) {$X$};
	  \node [style=none] (18) at (1, -0.75) {$Z$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	  \draw (0.center) to (1.center);
	  \draw (1.center) to (2.center);
	  \draw (2.center) to (3.center);
	  \draw (3.center) to (0.center);
	  \draw (4.center) to (5.center);
	  \draw (5.center) to (6.center);
	  \draw (6.center) to (7.center);
	  \draw (7.center) to (4.center);
	  \draw (8.center) to (13.center);
	  \draw [in=90, out=0, looseness=1.00] (9.center) to (12.center);
	  \draw [in=-90, out=0, looseness=1.00] (10.center) to (12.center);
	  \draw (11.center) to (14.center);
	\end{pgfonlayer}
      \end{tikzpicture}
    \end{aligned}
  \]
  in $\mc H_{\mathrm{str}}(I,X\cdot Z)$. 

  The monoidal product is given by
  \[
    \tikzset{every path/.style={line width=1.1pt}}
    \begin{aligned}
      \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
	  \node [style=none] (0) at (-0.25, 0.375) {};
	  \node [style=none] (1) at (0.5, 0.375) {};
	  \node [style=none] (2) at (-0.25, -0.375) {};
	  \node [style=none] (3) at (0.5, -0.375) {};
	  \node [style=none] (4) at (0.5, 0.25) {};
	  \node [style=none] (5) at (0.5, -0.25) {};
	  \node [style=none] (6) at (1.25, 0.25) {};
	  \node [style=none] (7) at (1.25, -0.25) {};
	  \node [style=none] (8) at (0.125, -0) {$s$};
	  \node [style=none] (9) at (1.5, 0.25) {$X$};
	  \node [style=none] (10) at (1.5, -0.25) {$Y$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	  \draw (0.center) to (1.center);
	  \draw (1.center) to (3.center);
	  \draw (3.center) to (2.center);
	  \draw (2.center) to (0.center);
	  \draw (4.center) to (6.center);
	  \draw (5.center) to (7.center);
	\end{pgfonlayer}
      \end{tikzpicture}
    \end{aligned}
    \quad 
    +
    \quad
    \begin{aligned}
      \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
	  \node [style=none] (0) at (-0.25, 0.375) {};
	  \node [style=none] (1) at (0.5, 0.375) {};
	  \node [style=none] (2) at (-0.25, -0.375) {};
	  \node [style=none] (3) at (0.5, -0.375) {};
	  \node [style=none] (4) at (0.5, 0.25) {};
	  \node [style=none] (5) at (0.5, -0.25) {};
	  \node [style=none] (6) at (1.25, 0.25) {};
	  \node [style=none] (7) at (1.25, -0.25) {};
	  \node [style=none] (8) at (0.125, -0) {$t$};
	  \node [style=none] (9) at (1.5, 0.25) {$Z$};
	  \node [style=none] (10) at (1.5, -0.25) {$W$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	  \draw (0.center) to (1.center);
	  \draw (1.center) to (3.center);
	  \draw (3.center) to (2.center);
	  \draw (2.center) to (0.center);
	  \draw (4.center) to (6.center);
	  \draw (5.center) to (7.center);
	\end{pgfonlayer}
      \end{tikzpicture}
    \end{aligned}
    \quad = \quad 
    \begin{aligned}
      \begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
	  \node [style=none] (0) at (-0.875, 0.875) {};
	  \node [style=none] (1) at (-0.125, 0.875) {};
	  \node [style=none] (2) at (-0.125, 0.125) {};
	  \node [style=none] (3) at (-0.875, 0.125) {};
	  \node [style=none] (4) at (-0.875, -0.125) {};
	  \node [style=none] (5) at (-0.125, -0.125) {};
	  \node [style=none] (6) at (-0.125, -0.875) {};
	  \node [style=none] (7) at (-0.875, -0.875) {};
	  \node [style=none] (8) at (-0.125, 0.75) {};
	  \node [style=none] (9) at (-0.125, 0.25) {};
	  \node [style=none] (10) at (-0.125, -0.25) {};
	  \node [style=none] (11) at (-0.125, -0.75) {};
	  \node [style=none] (12) at (1, 0.75) {};
	  \node [style=none] (13) at (1, 0.25) {};
	  \node [style=none] (14) at (1, -0.25) {};
	  \node [style=none] (15) at (1, -0.75) {};
	  \node [style=none] (16) at (-0.5, 0.5) {$s$};
	  \node [style=none] (17) at (-0.5, -0.5) {$t$};
	  \node [style=none] (18) at (1.25, 0.75) {$X$};
	  \node [style=none] (19) at (1.25, 0.25) {$Z$};
	  \node [style=none] (20) at (1.25, -0.25) {$Y$};
	  \node [style=none] (21) at (1.25, -0.75) {$W.$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	  \draw (0.center) to (1.center);
	  \draw (1.center) to (2.center);
	  \draw (2.center) to (3.center);
	  \draw (3.center) to (0.center);
	  \draw (4.center) to (5.center);
	  \draw (5.center) to (6.center);
	  \draw (6.center) to (7.center);
	  \draw (7.center) to (4.center);
	  \draw (8.center) to (12.center);
	  \draw [in=180, out=0, looseness=1.00] (9.center) to (14.center);
	  \draw [in=180, out=0, looseness=1.00] (10.center) to (13.center);
	  \draw (11.center) to (15.center);
	\end{pgfonlayer}
      \end{tikzpicture}
    \end{aligned}
  \]

  Taking a hint from the compact closed structure, the isomorphism between
  $F\mathrm{Corel}$ and $\mc H_{\mathrm{str}}$ is then clear: the functors act as
  the identity on objects, and on morphisms take $f: X \to Y$ in $\mc
  H_{\mathrm{str}}$ to its name $\hat f: I \to X\cdot Y$ as a morphism of
  $F\mathrm{Corel}$, and vice versa. 
  
  It is straightforward to check that these are strict hypergraph functors. To
  demonstrate the most subtle aspect, the Frobenius structure, we consider the
  multiplication on an object $X$ of $F\mathrm{Corel}$. To obtain this, we start
  with the multiplication in $F\mathrm{Cospan}$, the cospan $X+X
  \xrightarrow{[1,1]} X \xleftarrow{1} X$ decorated with the empty decoration,
  which in this case is $\eta_X \in \mc H_{\mathrm{str}}(I,X)$, and restrict this empty
  decoration along the map $X \xleftarrow{[1,1,1]} X+X+X$. Thus the
  multiplication on $X$ in $F\mathrm{Corel}$ is 
  \[
    \tikzset{every path/.style={line width=1.1pt}}
    \begin{aligned}
      \begin{tikzpicture}[scale=.65]
	\begin{pgfonlayer}{nodelayer}
	  \node [style=none] (0) at (0.75, 0.5) {};
	  \node [style=dot] (1) at (0, -0) {};
	  \node [style=none] (2) at (0.75, -0.5) {};
	  \node [style=none] (3) at (1.5, 0.5) {$X$};
	  \node [style=none] (4) at (1.25, 0.5) {};
	  \node [style=none] (5) at (1.25, -0.5) {};
	  \node [style=dot] (6) at (-1.25, -0.5) {};
	  \node [style=none] (7) at (-0.5, -1) {};
	  \node [style=none] (8) at (1.25, -1) {};
	  \node [style=none] (9) at (-0.5, -0) {};
	  \node [style=dot] (10) at (-2, -0.5) {};
	  \node [style=none] (11) at (1.5, -0.5) {$X$};
	  \node [style=none] (12) at (1.5, -1) {$X$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	  \draw [in=90, out=180, looseness=0.90] (0.center) to (1.center);
	  \draw [in=-90, out=180, looseness=0.90] (2.center) to (1.center);
	  \draw (4.center) to (0.center);
	  \draw (5.center) to (2.center);
	  \draw [in=90, out=180, looseness=0.90] (9.center) to (6);
	  \draw [in=-90, out=180, looseness=0.90] (7.center) to (6);
	  \draw (6) to (10.center);
	  \draw (8.center) to (7.center);
	  \draw (9.center) to (1);
	\end{pgfonlayer}
      \end{tikzpicture}
    \end{aligned}
    \in \mc H_{\mathrm{str}}(I,X \cdot X \cdot X),
  \]
  which corresponds under our isomorphism to the map $\mu_X\maps X \cdot X \to X
  \in \mc H_{\mathrm{str}}$, as required.
\end{proof}

Similarly, every hypergraph functor can be recovered using decorated
corelations. The key point here is again the compact closed structure: a
hypergraph functor $(T,\tau) \maps (\mc H,\ot) \to (\mc H',\boxtimes)$ takes
morphisms $f\maps X \to Y$ to morphisms $Tf\maps TX \to TY$, and hence induces a
function from the set of names $I \to X \ot Y$ to the set of names
$I' \to TX \boxtimes TY$.

\begin{theorem} \label{thm.hypdeccorfunctors}
  Every hypergraph functor can be constructed as a decorated corelation functor.
  
  More precisely, let $(\mc H,\ot)$, $(\mc H',\boxtimes)$ be hypergraph
  categories and $(T,\tau)\maps \mc H \to \mc H'$ be a hypergraph functor. By
  the previous theorem, there exist lax symmetric monoidal functors
  \[
    F\maps \cospan(\FinSet_{\mc O}) \to \Set \quad \mbox{and} \quad F'\maps
    \cospan(\FinSet_{\mc O'}) \to \Set
  \]
  such that we have isomorphisms $\mc H_{\mathrm{str}} \cong F\mathrm{Corel}$
  and $\mc H_{\mathrm{str}}' \cong F'\mathrm{Corel}$.
  
  There exists a colimit-preserving functor $A\maps \FinSet_{\mc O} \to
  \FinSet_{\mc O'}$ and a monoidal natural transformation
  \[
    \xymatrixrowsep{2ex}
    \xymatrix{
      \cospan(\FinSet_{\mc O}) \ar[dd]_{A} \ar[drr]^F  \\
      &\twocell \omit{_\:\theta}& \Set \\
      \cospan(\FinSet_{\mc O'}) \ar[urr]_{F'} 
    }
  \]
  such that the resulting decorated corelation functor makes the
  diagram of hypergraph functors
  \[
    \xymatrix{
      \mc H \ar[d]_\sim \ar[r]^{T} & \mc H' \ar[d]^\sim \\
      F\mathrm{Corel} \ar[r] & F'\mathrm{Corel}
    }
  \]
  commute.
\end{theorem}
\begin{proof}
  On objects, define the functor $A\maps \cospan(\FinSet_{\mc O}) \to
  \cospan(\FinSet_{\mc O'})$ to take each $\mc O$-labelled set $X=[x_1:\ldots:x_n]$,
  written here as a string of elements of $\mc O$, to the $\mc O'$-labelled set
  $TX=[Tx_1:\ldots:Tx_n]$ comprising the same set but changing each label $x_i$ to
  $Tx_i$. On morphisms, let it take a function between $\mc O$-labelled sets to
  the same function between the underlying sets, noting that the function now
  preserves the $\mc O'$-labels. This functor $A$ clearly preserves colimits:
  again, colimits in $\FinSet_{\mc O}$ are just colimits in $\FinSet$ with the
  labels inherited as described above.

  Let $X=[x_1:\ldots:x_n]$ be an $\mc O$-labelled set, and recall that we write
  $PX= (((x_1\ot x_2) \ot \dots )\ot x_n) \ot I$ for the monoidal product of
  this string in $\mc H$ with all open parentheses at the front. We define
  \begin{align*}
    \theta_X\maps \mc H_{\mathrm{str}}(I,X) = \mc H(I,PX) &\longrightarrow \mc
    H'_{\mathrm{str}}(I', TX)= \mc H'(I',PTX); \\
    \Big(I \stackrel{s}\to PX\Big) &\longmapsto \Big(I' \xrightarrow{\tau_I} TI
    \xrightarrow{Ts} TPX \xrightarrow{\tau_\ast} PTX\Big), 
  \end{align*}
  where $\tau_\ast$ is the appropriate composite of coherence isomorphisms of
  $T$. This collection of maps $\theta$ is natural because (i) functions in
  $\FinSet_{\mc O}$ act as the Frobenius maps on the homsets $\mc H(I,X)$ and
  $\mc H'(I',TX)$, and (ii) the functor $T$ is hypergraph and thus sends,
  loosely speaking, Frobenius maps to Frobenius maps. Moreover $\theta$ is
  monoidal as $T$ is monoidal.  Thus $\theta$ defines a monoidal natural
  transformation.

  The hypergraph functor $F\mathrm{Corel} \to F'\mathrm{Corel}$ induced by
  $\theta$ is by definition the map taking the decoration $s \in \mc
  H(I,P(X\cdot Y))$ to the decoration $\tau_\ast \circ Ts \circ
  \tau_I \in \mc H'(I',PT(X \cdot Y))$. It is immediate that the above square
  commutes. We thus say that $T$ can be constructed as a decorated corelation
  functor.
\end{proof}

\subsection{A categorical equivalence}

Choose Grothendieck universes so that we may talk about the category $\Set$ now
only of all so-called small sets, and the category $\mathrm{Cat}$ of all small
categories. If we restrict our attention to small hypergraph categories, we may
summarise these results as a categorical equivalence. 

Indeed, given some fixed object set $\mc O$, we have a category of lax symmetric
monoidal functors and monoidal natural transformations
\[
  \mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O}),\Set).
\]
This is equivalent to some subcategory of the category $\mathrm{HypCat}$ of
hypergraph categories. To get a category equivalent to $\mathrm{HypCat}$, we
must patch together these functor categories by varying the object set and
specifying morphisms from objects in one category to objects in another. For
this we use the Grothendieck construction. 

Given a (contravariant) functor $S\maps \mc B \to \mathrm{Cat}$ from some
category $\mc B$ to $\mathrm{Cat}$, we define the \define{(contravariant)
Grothendieck construction} $\mc B \int S$ to be the category with pairs
$(\mc O,F)$ where $\mc O$ is an object of $\mc B$ and $F$ is an object of $S\mc
O$ as objects, and pairs 
\[
  (f,\theta)\maps (\mc O,F) \longrightarrow (\mc O',F')
\]
where $f\maps \mc O \to \mc O'$ is a morphism in $\mc B$ and $\theta\maps F \to
Sf(F')$ is a morphism in $S\mc O$ as morphisms. Given another morphism
$(g,\zeta)\maps (\mc O', F') \to (\mc O'',F'')$, the composite morphism in the
pair $(g \circ f, Sf\zeta \circ \theta)$.

Now, define the functor 
\[
  \mathrm{LaxSymMon}(\cospan(\FinSet_{-}), \Set)\maps \Set \longrightarrow
  \mathrm{Cat}
\]
as follows. On objects let it map a set $\mc O$ to the lax symmetric monoidal
functor category $\mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O}), \Set)$. For
morphisms, we noted at the beginning of the proof of Theorem
\ref{thm.hypdeccorfunctors} that a function $r\maps \mc O \to \mc O'$ from one
set of labels to another induces a functor $R\maps \cospan(\FinSet_{\mc O}) \to
\cospan(\FinSet_{\mc O'})$ taking each $\mc O$-labelled set $N \stackrel{l}\to
\mc O$ to the $\mc O'$-labelled set $N \xrightarrow{r \circ l} \mc O'$. This in
turn defines a functor 
\begin{align*}
 \mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O'}), \Set) &\longrightarrow
\mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O}), \Set); \\
\Big(F'\maps
\cospan(\FinSet_{\mc O'}) \to \Set\Big) &\longmapsto \Big(R\circ F'\maps  \cospan(\FinSet_{\mc O})
\to \Set\Big).
\end{align*}
by post-composition with $R$. Note that
$\mathrm{LaxSymMon}(\cospan(\FinSet_{-}), \Set)$ is a well-defined functor: in
particular, it preserves composition on the nose.

The Grothendieck construction 
\[
 \Set\int \mathrm{LaxSymMon}(\cospan(\FinSet_{-}), \Set)
\]
thus gives a category where the objects are some label set $\mc O$ together with
an object in $\mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O}), \Set)$---that is,
with a lax symmetric monoidal functor $F\maps (\cospan(\FinSet_{\mc O}),+) \to
(\Set,\times)$. The morphisms $(\mc O, F) \to (\mc O,F')$ are functions of label
sets $r: \mc O \to \mc O'$ together with a natural transformation $\theta\maps
R \circ F'\Rightarrow F$.

In the case of small categories, it is not difficult to show that Theorems
\ref{thm.hypdeccorcats} and \ref{thm.hypdeccorfunctors} imply:

\begin{theorem} \label{thm.equivhypdccor}
  There is an equivalence of categories
\[
  \mathrm{HypCat} \cong \Set\int \mathrm{LaxSymMon}(\cospan(\FinSet_{-}), \Set).
\]
\end{theorem}

The 2-categorical version of the above equivalence is also the subject of a
forthcoming paper by Vagner, Spivak, and Schultz, from their operadic
perspective \cite{VSS}.

\begin{remark}
  It is prudent, to wonder, in the definition of hypergraph category, why it is
  useful to define a structure---the Frobenius maps---on a category that does
  not interact with the morphisms of the category. This affects, for example,
  invariance under equivalence of symmetric monoidal categories: given two
  equivalent symmetric monoidal categories, the hypergraph structures on these
  categories need not be in one-to-one correspondence. The Frobenius maps,
  however, are seen by the monoidal product and by hypergraph functors. Theorem
  \ref{thm.equivhypdccor} provides a more invariant definition of the category
  of hypergraph categories.
\end{remark}

\subsection{Factorisations as decorations}

We have seen that every hypergraph category can be constructed as a decorated
corelations category. More precisely, we have seen that every hypergraph
category can be constructed as a decorated corelation category with the
factorisation system the trivial isomorphism-morphism factorisation system. But
we can also use other factorisation systems to construct decorated corelation
categories, and these are also hypergraph categories. This implies that we might
have multiple decorated corelation constructions for the same hypergraph
category.  How do these constructions relate to each other?

Recall from Remark \ref{rem.corelposet} that for any category $\mc C$ with
finite colimits there exists a poset of factorisation systems $(\mc E,\mc M)$
with $\mc M$ stable under pushout, where the order is given by reverse inclusion
on $\mc M$. Suppose we choose a factorisation system $(\mc E,\mc M)$ and have a
lax symmetric monoidal functor
\[
  F\maps \mc C;\mc M^\opp \longrightarrow \Set.
\]
This defines a decorated corelation category. Although we will not prove it
here, it is in fact possible to construct a hypergraph equivalent decorated
corelation category using any factorisation system $(\mc E',\mc M')$ less than
$(\mc E,\mc M)$. Roughly, the idea is that although moving to a smaller
factorisation system results in fewer corelations, we may store any lost
information in the decorations by altering the functor $F$ in the right way.
The proof of Theorem \ref{thm.hypdeccorcats} shows how to do this for the
factorisation system at the bottom of this poset, the isomorphism-morphism
factorisation system $(\mc I_{\mc C},\mc M)$.

For illustration, we example this interaction for the simplest hypergraph
category: $\cospan(\FinSet)$, the free hypergraph category on a single object.

\begin{example}
  As per Example \ref{ex.undeccorel}, $\cospan(\FinSet)$ is the hypergraph
  category of undecorated morphism-isomorphism corelations in $\FinSet$.
  Theorem \ref{thm.hypdeccorcats} shows it is also the hypergraph category of
  function-decorated isomorphism-morphism corelations in $\FinSet$.   
  
  The construction in Theorem \ref{thm.hypdeccorcats} proceeds as follows.
  First, we construct a lax symmetric monoidal functor $F\maps \cospan(\FinSet)
  \to \Set$. On objects $F$ takes each finite set $X$ to the set of isomorphism
  classes of cospans $\varnothing \to D \leftarrow X$ from the monoidal unit
  $\varnothing$ to $X$ or, equivalently, the set $FX$ of functions $s\maps X \to
  D$, where a unique codomain $D$ is chosen for each finite cardinality. On
  morphisms, $F$ takes a cospan $X \stackrel{f}\to N \stackrel{g}\leftarrow Y$
  to the function $FX \to FY$ that maps $s\maps X \to D$ in $FX$ to the function
  $Y \to N+_XD$ in $FY$ given by
  \[
    \xymatrix{
      & X \ar[r]^s \ar[d]_f & D \ar[d] \\
      Y \ar[r]^g  & N \ar[r] & N+_XD
    }
  \]
  where the square is a pushout square. For coherence maps, the map
  $\varphi_1\maps 1 \to F\varnothing$ takes the unique element of $1$ to the
  unique function $!\maps \varnothing \to \varnothing$, while $\varphi_{X,Y}$
  takes a pair of functions $a\maps X \to D$, $b\maps Y \to E$ to $a+b\maps X+Y
  \to D+E$. This defines a lax symmetric monoidal functor $(F,\varphi)$.

  A decorated \emph{cospan} in $\FinSet$ with respect to $(F,\varphi)$ is then a
  cospan of finite sets $X \to N \leftarrow Y$ together with a function of
  finite sets $N \to D$. Using the isomorphism-morphism factorisation, a
  decorated \emph{corelation} is thus a cospan $X \xrightarrow{\iota_X} X+Y
  \xleftarrow{\iota_Y} Y$ together with a function $X+Y \to D$. As there is a
  unique isomorphism class of $\mc I_{\FinSet}$-like cospans $X
  \xrightarrow{\iota_X} X+Y \xleftarrow{\iota_Y} Y$, a decorated corelation is
  thus specified by its decoration $X+Y \to D$ alone. Note that
  maps $X+Y \to D$ are in one-to-one correspondence with cospans $X \to D
  \leftarrow Y$ in $\FinSet$ via the coproduct inclusion maps.

  As observed in the proof of Theorem \ref{thm.hypdeccorcats}, the hypergraph
  structure on $F\mathrm{Corel}$ agrees with that on $\cospan(\FinSet)$ via
  this correspondence; the multiplication \linebreak $\mu_X\maps X+X \to X$ in
  $F\mathrm{Corel}$ is simply given by the decoration $(X+X)+X \to X$, and so
  on. The intuition is that $F$ takes the `factored out part' of the corelation
  and puts it into the decoration. 

  This correspondence between maps $X+Y \to D$ and cospans $X \to D\leftarrow Y$
  suggests an isomorphism. Indeed, the equivalence given by Theorem
  \ref{thm.hypdeccorcats} is precisely this. We can construct one direction, the
  one from the smaller to larger $\mc M$---that is, from $\mc M = \mc
  I_{\FinSet}$ to $\mc M = \FinSet$---as a decorated corelations functor.  Note
  that the identity on $\FinSet$ maps the subcategory $\mc I_{\FinSet}$ into
  $\FinSet$, and so extends to a morphism $\FinSet \to \cospan(\FinSet)$. Also
  recall (from say Example \ref{ex.undeccorel}) that the `undecorated' cospan
  category $\cospan(\FinSet)$ is equal to the decorated cospan category given by
  the functor $1\maps \FinSet \to \Set$ mapping each finite set to some chosen
  one element set $1$, and each morphism to the identity morphism on $1$. Define
  monoidal natural transformation 
  \[
    \xymatrixrowsep{2ex}
    \xymatrix{
      \FinSet = \FinSet; \mc I_{\FinSet}^\opp \ar[dd]_{\iota} \ar[drr]^(.65)1  \\
      &\twocell \omit{_\:\theta}& \Set \\
      \cospan(\FinSet) = \FinSet; \FinSet^\opp \ar[urr]_(.65){G} 
    }
  \]
  with each $\theta_X \maps 1 \to GX$ mapping the unique element to the identity
  function $1_X\maps X \to X$.  This gives the hypergraph functor we expect,
  mapping the undecorated cospan $X \to N \leftarrow Y$ to the trivial cospan $X
  \to X+Y \leftarrow Y$ decorated by $X+Y \to N$. It is now routine to verify
  this is an isomorphism.
\end{example}

The previous example extends to any category $\mc C$ with finite colimits: the
hypergraph category $\cospan(\mc C)$ can always be constructed as (i)
trivially decorated $(\mc C, \mc I_{\mc C})$-corelations, or (ii) $(\mc I_{\mc
C}, \mc C)$-corelations decorated by equivalence classes of morphisms with
domain the apex of the corelation. Moreover, the isomorphism of these
hypergraph categories is given by the analogous monoidal natural transformation
between the decorating functors.

More general still, a category of trivially decorated $(\mc E, \mc
M)$-corelations in $\mc C$ can always be constructed also as $(\mc I_{\mc C},
\mc C)$-corelations decorated by equivalence classes of morphisms in $\mc E$
with domain the apex of the corelation, and the isomorphism of these
hypergraph categories a decorated corelations functor.

Most generally, we can still perform this construction on decorated corelation
categories: Theorem \ref{thm.hypdeccorcats} implies any category of $(\mc E,\mc
M)$-decorated corelations can be constructed also as $(\mc I_{\mc C}, \mc
C)$-corelations decorated by codomain decorated morphisms in $\mc E$. Given some
lax symmetric monoidal functor
\[
  F\maps \enspace \mc C;\mc M^\opp \longrightarrow \Set,
\]
the decorated $(\mc I_{\mc C}, \mc C)$-corelations are specified by the functor
\[
  F'\maps \cospan(\mc C) \longrightarrow \Set
\]
taking any object $Z \in \cospan(\mc C)$ to the pair $(Z \stackrel{e}\to N,
\enspace 1\stackrel{s}\to FN)$, where $e$ is a morphism in $\mc E$.

What is the utility of this variety of constructions? Different constructions
suit different purposes. At the top of the poset, consider the
morphism-isomorphism factorisation system: these give decorated cospan
categories. Decorated cospan categories provide, as we saw for open electric
circuits, an intuitive way to construct a `syntactic' hypergraph category from
some notion of network-style diagrammatic language. Moreover, they are decorated
corelation categories with $\mc M = \mc I_{\mc C}$ as small as possible. This
makes it easy to use decorated corelations to construct hypergraph
functors---such as those describing the semantics of diagrams---from a decorated
cospan category to another category.

To do this, however, we need to construct hypergraph categories of semantics.
Here epi-mono corelations are a useful tool. Indeed, some hypergraph categories
are very naturally constructed as corelation (or, dually, relation) categories,
such as the categories of equivalence relations, relations, or linear relations.
Here the factorisation system has an intuitive interpretation, such as the
epimorphisms retaining only the structure in the apex that is `accessible' or
`mapped onto' by the feet/boundary. Decorating these corelations retains the
same sort of intuition. 

Finally, at the bottom of the poset, we have the isomorphism-morphism
factorisation system. These give rise to the decorated corelation categories
constructed in Theorem \ref{thm.hypdeccorcats}, in which the factorisation
system is the trivial isomorphism-morphism one and all interesting structure is
carried by the apex of the decorated corelation. Note that these have $\mc M =
\mc C$ as large as possible, and also large sets of decorations. This makes it
easy to construct functors into a given hypergraph category. Thus we might first
define a semantic category as an epi-mono corelation category to match our
intuitions, and then later use an equivalent definition as a
isomorphism-morphism corelation category to facilitate construction of semantic
functors.

Indeed, the ability to construct functors from one hypergraph category to
another is essential for the understanding of hypergraph categories as
network-type diagrammatic languages, with functors not just giving rise to
notions of semantics, but hence also notions of equivalence of diagrams, and
reasoning tools.

We will illustrate these principles in greater depth in Part \ref{part.apps},
which delves into applications of this philosophy and framework. We conclude
this section and Part \ref{part.maths} with two examples of a more abstract
nature.

\section{Examples} \label{sec:excor}
We give two extended examples. Our first example is to revisit the matrix
example from the introduction, having now developed the necessary material. Our
second example is to revisit the category of linear relations once more, showing
that we can also construct it as a decorated corelation category. 

\subsection{Matrices} \label{ssec.matrices}

Let $R$ be a commutative rig.\footnote{Also known as a semiring, a rig is a ring
  without \emph{n}egatives.} In this subsection we will
construct matrices over $R$ as decorated corelations over $\FinSet^\opp$. 

In $\FinSet^\opp$ the coproduct is the Cartesian product $\times$ of sets, the
initial object is the one element set $1$, and cospans are spans in $\FinSet$.
The notation will thus be less confusing if we talk of decorated spans on
$(\FinSet,\times)$ given by the contravariant lax monoidal functor
\begin{align*}
  R^{(-)}: (\mathrm{FinSet},\times) &\longrightarrow (\Set,\times); \\
  N &\longmapsto R^N \\
  \Big(f\maps N \to M\Big) &\longmapsto \Big(R^f\maps R^M \to R^N; v \mapsto v \circ
  f\big).
\end{align*}
The coherence maps $\varphi_{N,M}\maps R^N \times R^M \to R^{N\times M}$ take a
pair $(s,t)$ of maps $s\maps N \to R$, $t\maps M \to R$ to the pointwise product
$s\cdot t \maps N\times M \to R; (n,m) \mapsto s(n) \cdot t(m)$. The unit
coherence map $\varphi_1\maps 1 \to R^1$ sounds almost tautological: it takes
the unique element of the one element set $1$ to the function $1 \to R$ that
maps the unique element of the one element set to the multiplicative identity
$1_R$ of the rig $R$.  As described in Section \ref{sec.blackboxedsystems},
$R^{(-)}\mathrm{Cospan}$ can be considered as the category of `multivalued
matrices' over $R$, and $R^{(-)}\mathrm{Corel}$ the category of matrices over
$R$.

Just as the coherence map $\varphi_1$ gives the unit for the multiplication, it
is the coherence maps $\varphi_{N,M}$ that enact multiplication of scalars:
the composite of decorated spans $(X \xleftarrow{i_X} N \xrightarrow{o_Y} Y,\enspace N
\xrightarrow{s} R)$ and $(Y \xleftarrow{i_Y} M \xrightarrow{o_Z} Z,\enspace M
\xrightarrow{t} R)$ is the span $X \leftarrow N\times_YM \rightarrow Z$ decorated
by the map
\[
  N \times_YM \hooklongrightarrow N \times M \xrightarrow{\varphi_{N,M}(s,t) = s \cdot t}
  R,
\]
where the inclusion from $N \times_YM$ into $N \times M$ is that given by the
categorical product. We discussed the intuition for this composition rule, in
terms of paths between elements of $X$ and those of $Z$, in Section
\ref{sec.blackboxedsystems}. 

As $\varphi_1$ selects the multiplicative unit $1_R$ of $R$, the empty
decoration on any set $N$ is the function that sends every element of $N$ to
$1_R$. This implies the identity decorated span on $X = \{x_1,\dots, x_n\}$ is
that represented by the diagram
\[
    \tikzset{every path/.style={line width=.8pt}}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (1.75, 0.5) {};
		\node [style=sdot] (1) at (-1.75, -1) {};
		\node [style=sdot] (2) at (1.75, -1) {};
		\node [style=none] (3) at (0, -0.25) {$\vdots$};
		\node [style=amp] (4) at (0, -1) {$1$};
		\node [style=amp] (5) at (0, 1) {$1$};
		\node [style=sdot] (6) at (1.75, 1) {};
		\node [style=amp] (7) at (0, 0.5) {$1$};
		\node [style=sdot] (8) at (-1.75, 0.5) {};
		\node [style=sdot] (9) at (-1.75, 1) {};
		\node [style=none] (10) at (1.75, -0.25) {$\vdots$};
		\node [style=none] (11) at (-1.75, -0.25) {$\vdots$};
		\node [style=none] (12) at (-2.125, 1) {$x_1$};
		\node [style=none] (13) at (-2.125, 0.5) {$x_2$};
		\node [style=none] (14) at (-2.125, -1) {$x_n$};
		\node [style=none] (15) at (2.125, 1) {$x_1$};
		\node [style=none] (16) at (2.125, 0.5) {$x_2$};
		\node [style=none] (17) at (2.125, -1) {$x_n$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (6) to (5);
		\draw (4) to (2);
		\draw (1) to (4);
		\draw (5) to (9);
		\draw (8) to (7);
		\draw (7) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\]
while the Frobenius multiplication and unit are 
\[
    \tikzset{every path/.style={line width=.8pt}}
  \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (1.75, -0.5) {};
		\node [style=sdot] (1) at (1.75, -2.25) {};
		\node [style=none] (2) at (0, -1.25) {$\vdots$};
		\node [style=amp] (3) at (0, -2.25) {$1$};
		\node [style=amp] (4) at (0, 1.5) {$1$};
		\node [style=sdot] (5) at (1.75, 1.5) {};
		\node [style=amp] (6) at (0, -0.5) {$1$};
		\node [style=sdot] (7) at (-1.75, -0.5) {};
		\node [style=none] (8) at (1.75, -1.25) {$\vdots$};
		\node [style=none] (9) at (-1.75, -1.25) {$\vdots$};
		\node [style=sdot] (10) at (-1.75, -2.25) {};
		\node [style=sdot] (11) at (-1.75, 1.5) {};
		\node [style=none] (12) at (2.125, 1.5) {$x_1$};
		\node [style=none] (13) at (2.125, -0.5) {$x_2$};
		\node [style=none] (14) at (2.125, -2.25) {$x_n$};
		\node [style=none] (15) at (-2.5, 1.5) {$(x_1,x_1)$};
		\node [style=none] (16) at (-2.5, -0.5) {$(x_2,x_2)$};
		\node [style=none] (17) at (-2.5, -2.25) {$(x_n,x_n)$};
		\node [style=none] (18) at (-2.5, 1) {$(x_1,x_2)$};
		\node [style=sdot] (19) at (-1.75, 1) {};
		\node [style=none] (21) at (-1.75, 0.5) {$\vdots$};
		\node [style=none] (22) at (1.75, 0.75) {$\vdots$};
		\node [style=sdot] (23) at (-1.75, -0) {};
		\node [style=none] (24) at (-2.5, -0) {$(x_2,x_1)$};
		\node [style=sdot] (25) at (-1.75, -1.75) {};
		\node [style=none] (26) at (-2.7, -1.75) {$(x_n,x_{n-1})$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5) to (4);
		\draw (3) to (1);
		\draw (7) to (6);
		\draw (6) to (0);
		\draw (10) to (3);
		\draw (4) to (11);
	\end{pgfonlayer}
\end{tikzpicture}
  \end{aligned}
  \qquad \mbox{and} \qquad
  \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (1.75, 0.5) {};
		\node [style=sdot] (1) at (1.75, -1) {};
		\node [style=none] (2) at (0, -0.25) {$\vdots$};
		\node [style=amp] (3) at (0, -1) {$1$};
		\node [style=amp] (4) at (0, 1) {$1$};
		\node [style=sdot] (5) at (1.75, 1) {};
		\node [style=amp] (6) at (0, 0.5) {$1$};
		\node [style=sdot] (7) at (-1.75, -0) {};
		\node [style=none] (8) at (1.75, -0.25) {$\vdots$};
		\node [style=none] (9) at (2.125, 1) {$x_1$};
		\node [style=none] (10) at (2.125, 0.5) {$x_2$};
		\node [style=none] (11) at (2.125, -1) {$x_n$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5) to (4);
		\draw (3) to (1);
		\draw (7) to (6);
		\draw (6) to (0);
		\draw (7) to (4);
		\draw (7) to (3);
	\end{pgfonlayer}
\end{tikzpicture}
  \end{aligned}
\]
respectively, with the comultiplication and counit the mirror images.

These morphisms are multivalued matrices in the following sense: the
cardinalities of the domain $X$ and the codomain $Y$ give the dimensions of the
matrix, and the apex $N$ indexes its entries. If $n \in N$ maps to $x \in X$ and
$y \in Y$, we say there is an entry of value $s(n) \in \R$ in the $x$th row and
$y$th column of the matrix. It is multivalued in the sense that there may be
multiple entries in any position $(x,y)$ of the matrix.

To construct matrices proper, and not just multivalued matrices, as decorated
relations, we extend $R^{(-)}$ to the contravariant functor
\[
  R^{(-)}: (\mathrm{Span(FinSet)},\times) \longrightarrow (\Set,\times)
\]
mapping now a span $N \stackrel{f}\leftarrow A \stackrel{g}\to M$ to the
function
\begin{align*}
  R^{f^\opp;g}\maps R^M &\longrightarrow R^N; \\
  v &\longmapsto \Big(n \mapsto \sum_{a \in f^{-1}(n)} v\circ g(a)\Big).
\end{align*}
It is simply a matter of computation to check this is functorial.

Decorated corelations in this category then comprise trivial spans $X
\xleftarrow{\pi_X} X \times Y \xrightarrow{\pi_Y} Y$, where $\pi$ is the
projection given by the categorical product, together with a decoration $X\times
Y \to R$. Such morphisms give a value of $R$ for each pair $(x,y) \in X \times
Y$, and thus are trivially in one-to-one correspondence with $\lvert X \rvert
\times \lvert Y\rvert$-matrices. 

The map $R^{(-)}\mathrm{Cospan} \to R^{(-)}\mathrm{Corel}$ transports the
decoration $N\times_YM \to R$ along the function $N \times_YM \to N \times M$
that identifies elements over the same pair $(x,y)$. In terms of the multivalued
matrices, this sums over (the potentially empty) set of entries over $(x,y)$ to
create a single entry. It is thus easily observed that composition in this
category is matrix multiplication. Moreover, it is not difficult to check that
the monoidal product is the Kroenecker product of matrices, and thus that
$R^{(-)}\mathrm{Corel}$ is monoidally equivalent to the monoidal category of
$(\FinVect, \otimes)$ of finite dimensional vector spaces, linear maps, and the
tensor product.

%Many aspects of this example are `atypical' for the intuition we have been
%working towards.  Note that the monoidal product here is the tensor product of
%matrices, not the biproduct. Indeed, there is no special commutative Frobenius
%algebra in $\Vect$ if we use the biproduct, but if we use the tensor product
%then these correspond to orthonormal bases (Vicary), as they do here.  

Note that $R^X$ is always an $R$-module, and $R^f$ a homomorphism of
$R$-modules. Thus we could take decorations here in the category $R\mathrm{Mod}$
of $R$-modules, rather than the category $\Set$. While Proposition
\ref{prop.setdecorations} shows that the resulting decorated cospan category
would be isomorphic, this may hint at an enriched version of the theory.

\subsection{Two constructions for linear relations}

We saw in \textsection\ref{ssec.linrel} that linear relations are epi-mono
corelations in $\Vect$. As linear relations thus form a hypergraph category
$\LinRel$, we can also give a decorated corelations construction. 

Indeed, Theorem \ref{thm.hypdeccorcats} shows that from the hom functor
$\LinRel(0,-)$ on the monoidal unit of the hypergraph category $\LinRel$, we can
build the functor
\[
  \mathrm{Lin} \maps\mathrm{Cospan}(\mathrm{FinSet}) \longrightarrow \mathrm{Set}
\]
taking a finite set $N$ to the set $\mathrm{Lin}(N)$ of linear subspaces of the
vector space $k^N$. Moreover, the image $\mathrm{Lin}(f)$ of a function $f\maps
N \to M$ maps a subspace $L \subseteq k^N$ to $\{v \mid v\circ f \in L\}
\subseteq k^M$, while the image $\mathrm{Lin}(f^\opp)$ of an opposite function
$g^\opp: N \to M$ maps a subspace $L \subseteq k^N$ to $\{v = u \circ g \mid u
\in L\} \subseteq k^M$. 

Given this functor, it can be shown that $\mathrm{LinCospan}$ is the category of
cospans decorated by subspaces, while $\mathrm{LinCorel}$ is the category of
linear relations. 

This pair of constructions is important for circuits work \cite{BF,BSZ}. Recall
the functor $\linsub\maps \FinSet \to \Set$ of Section \ref{sec:ex}, which takes
a finite set $X$ to the set of subspaces of $\R^X \oplus (\R^X)^*$.  This may be
extended to a functor $\cospan(\FinSet) \to \Set$, giving a decorated
corelations category of linear relations where the objects are the direct sum of
a vector space and its dual. Recall also that in Section \ref{sec:ex} we
discussed a functor 
\[
  \mathrm{GraphCospan} \to \mathrm{LinSubCospan}
\]
interpreting labelled graphs as linear subspaces. Composing this with the
quotient functor $\mathrm{LinSubCospan} \to \mathrm{LinSubCorel}$, this gives a
compositional linear relations semantics for circuit diagrams. This hints at the
material we explore in depth in Chapter \ref{ch.circuits}.


%DISCUSS HYPERGRAPH STRUCTURE?

%\subsection{Automata}
%This construction comes immediately from Walters et al. Automata are alphabet
%labelled graphs. There is a decorated cospan functor to categories enriched over
%languages, and this factors nicely to get a decorated corelation category with
%morphisms languages recognised between points in domain and codomain.
%
%a category of nondeterministic finite state automata
%
%a category of regular languages
%
%idea of black boxing is a Kleene theorem.



%  Our proof will have an inductive flavour. We first assume $\corel_(\mc C)$ is
%  well-defined as a hypergraph category, and show  We caution that we still have not proved that $\corel(\mc C)$ is a category,
%  let alone a hypergraph category. Thus to begin, all we can show is that the map
%  $\square$ is composition-preserving, and then that $\square$ respects the
%  monoidal and hypergraph structure. But this is enough to prove both
%  results! Indeed, specialising to the case where $A$ is the identity functor on
%  $\mc C$ and $(\mc E,\mc M)=(\mc C, \mc I_{\mc C})$, observe   
%  \[
%    \square \maps \cospan(\mc C) \longrightarrow \corel(\mc C)
%  \]
%  is then the map taking each cospan to its jointly $\mc E$-like part. Note
%  $\square$ maps fully (surjectively-on-morphisms) and bijectively-on-objects
%  onto $\corel(\mc C)$, and by definition the coherence and hypergraph maps on
%  $\corel(\mc C)$ are precisely the image of the corresponding maps of
%  $\cospan(\mc C)$. As $\cospan(\mc C)$ is a hypergraph category and $\square$
%  is composition-preserving, we can consequently conclude that all corelation
%  categories are indeed hypergraph categories, and hence that $\square$---in the
%  general case---is a hypergraph functor.
%
%  Finally, specialising to the case where $A$
%  is the identity functor on $\mc C$ and $(\mc E,\mc M)$ is the factorisation
%  system $(\mc C, \mc I_{\mc C})$, we observe that the domain of $\square$ is
%  then $\cospan(\mc C)$, and that $\square$ maps it fully
%  (surjectively-on-morphisms) and bijectively-on-objects onto $\corel(\mc C')$.
%  This shows that all corelation categories are indeed deserving of the name
%  category and moreover hypergraph category, and hence that $\square$ is
%  deserving of the name hypergraph functor.
