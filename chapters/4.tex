\chapter{Decorated corelations} \label{ch.deccorels}

When enough structure is available to us, we may decorate corelations too.
Furthermore, and key to the idea of `black-boxing', we get a hypergraph functor
from decorated cospans to decorated corelations. The decorated corelations
framework adds compositional operations to network-diagram representations, and
handles composition of semantics too. 

\section{Black-boxed open systems}

Suppose we have devices built from paths that take the signal at some input,
amplify it, and deliver it to some output. For simplicity let these signals be
real numbers, and amplication be linear: we just multiply by some fixed scalar.
We depict an example device like so:
\[
    \tikzset{every path/.style={line width=.8pt}}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (-2.5, 1.5) {};
		\node [style=sdot] (1) at (-2.5, -0) {};
		\node [style=sdot] (2) at (-2.5, -1.5) {};
		\node [style=amp] (3) at (-0.75, 2) {$5$};
		\node [style=amp] (4) at (-0.75, 1.25) {$1$};
		\node [style=amp] (5) at (-0.75, -1) {$-2$};
		\node [style=amp] (6) at (-0.75, 0.25) {$2.1$};
		\node [style=amp] (7) at (-0.75, -0.25) {$-0.4$};
		\node [style=sdot] (8) at (1, -0.5) {};
		\node [style=sdot] (9) at (1, -1.5) {};
		\node [style=sdot] (10) at (1, 0.5) {};
		\node [style=sdot] (11) at (1, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.west) to (0.center);
		\draw (4.west) to (0.center);
		\draw (6.west) to (1.center);
		\draw (7.west) to (1.center);
		\draw (5.west) to (2.center);
		\draw (3) to (11);
		\draw (4) to (11);
		\draw (6) to (10);
		\draw (7) to (8);
		\draw (5) to (8);
	\end{pgfonlayer}
\end{tikzpicture}
\]
Here there are three inputs, four outputs, and five paths. Formally, we might
model these devices as finite sets of inputs $X$, outputs $Y$, and paths $N$,
together with functions $i\maps N \to X$ and $o\maps N \to Y$ describing the
start and end of each path, and a function $s\maps N \to \R$ describing the
amplification along it. In other words, these are cospans $X \to N \leftarrow Y$
in $\FinSet^\opp$ decorated by `scalar assignment' functions $N \to \R$. This
suggests a decorated cospans construction.

Such a construction can be obtained from the lax symmetric monoidal functor
$\mathbb R^{(-)}\maps \FinSet^\opp \to \Set$ taking a finite set $N$ to the set
$\R^N$ of functions $s\maps N \to \R$, and opposite functions $f^\opp\maps N \to
M$ to the map taking $s\maps N \to \R$ to $s \circ f \maps M \to \R$. Note that
the coproduct in $\FinSet^\opp$ is the cartesian product of sets. The coherence
maps of the functor which, recall, are critical for the composition of the
decorations, are given by $\varphi_{N,M}\maps \R^N \times \R^M \to \R^{N\times
M}$, taking $(s,t) \in \R^N \times \R^M$ to the function $s \cdot t\maps N
\times M \to \R$ defined by pointwise multiplication in $\R$. 

Composition in this decorated cospans category is thus given by the
multiplication in $\R$. In detail, given decorated cospans $(X
\xrightarrow{i_X^\opp} N \xleftarrow{o_Y^\opp} Y, N \xrightarrow{s} \R)$ and $(Y
\xrightarrow{i_Y^\opp} M \xleftarrow{o_Z^\opp} Z, M \xrightarrow{t} \R)$, the
composite has a path from $x \in X$ to $z \in Z$ for every triple $(y,n,m)$
where $y \in Y$, $n \in N$, and $m \in M$, such that $n$ is a path from $x$ to
$y$ and $m$ is a path from $y$ to $z$. The scalar assigned to this path is the
product of those assigned to $n$ and $m$. For example, we have the following
composite
\[
    \tikzset{every path/.style={line width=.8pt}}
    \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (-2.5, 1.5) {};
		\node [style=sdot] (1) at (-2.5, -0) {};
		\node [style=sdot] (2) at (-2.5, -1.5) {};
		\node [style=amp] (3) at (-0.75, 2) {$5$};
		\node [style=amp] (4) at (-0.75, 1.25) {$1$};
		\node [style=amp] (5) at (-0.75, -1) {$-2$};
		\node [style=amp] (6) at (-0.75, 0.25) {$2.1$};
		\node [style=amp] (7) at (-0.75, -0.25) {$-0.4$};
		\node [style=sdot] (8) at (1, -0.5) {};
		\node [style=sdot] (9) at (4.5, 0.5) {};
		\node [style=sdot] (10) at (1, -1.5) {};
		\node [style=sdot] (11) at (4.5, -1.5) {};
		\node [style=amp] (12) at (2.75, -0.5) {$-1$};
		\node [style=amp] (13) at (2.75, 1.25) {$3$};
		\node [style=amp] (14) at (2.75, -1.5) {$-2.3$};
		\node [style=amp] (15) at (2.75, 2) {$1$};
		\node [style=sdot] (16) at (4.5, 1.5) {};
		\node [style=amp] (17) at (2.75, -0) {$3$};
		\node [style=sdot] (18) at (4.5, -0.5) {};
		\node [style=sdot] (19) at (1, 0.5) {};
		\node [style=sdot] (20) at (1, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.west) to (0.center);
		\draw (4.west) to (0.center);
		\draw (6.west) to (1.center);
		\draw (7.west) to (1.center);
		\draw (5.west) to (2.center);
		\draw (16) to (15);
		\draw (16) to (13);
		\draw (18) to (12);
		\draw (14) to (11);
		\draw (10) to (14);
		\draw (15) to (20);
		\draw (13) to (20);
		\draw (3) to (20);
		\draw (4) to (20);
		\draw (6) to (19);
		\draw (7) to (8);
		\draw (5) to (8);
		\draw (12) to (8);
		\draw (19) to (17);
		\draw (17) to (18);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\qquad = \qquad
\begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (-2.5, 1.5) {};
		\node [style=sdot] (1) at (-2.5, -0) {};
		\node [style=sdot] (2) at (-2.5, -1.5) {};
		\node [style=amp] (3) at (-0.75, 1.75) {$15$};
		\node [style=amp] (4) at (-0.75, 1.25) {$1$};
		\node [style=amp] (5) at (-0.75, -1) {$2$};
		\node [style=amp] (6) at (-0.75, -0) {$6.3$};
		\node [style=amp] (7) at (-0.75, -0.5) {$0.4$};
		\node [style=sdot] (8) at (1, -0.5) {};
		\node [style=sdot] (9) at (1, -1.5) {};
		\node [style=sdot] (10) at (1, 0.5) {};
		\node [style=sdot] (11) at (1, 1.5) {};
		\node [style=amp] (12) at (-0.75, 2.25) {$5$};
		\node [style=amp] (13) at (-0.75, 0.75) {$3$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.west) to (0.center);
		\draw (4.west) to (0.center);
		\draw (6.west) to (1.center);
		\draw (7.west) to (1.center);
		\draw (5.west) to (2.center);
		\draw (3) to (11);
		\draw (4) to (11);
		\draw (7) to (8);
		\draw (5) to (8);
		\draw (0) to (12);
		\draw (12) to (11);
		\draw (0) to (13);
		\draw (13) to (11);
		\draw (6) to (8);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\]
There are four paths between the top-most element $x_1$ of the domain and the
top-most element $z_1$ of the codomain: we may first take the path that
amplifies by $5\times$ and then the path that amplifies by $1\times$ for a total
amplification of $5\times$, or $5\times$ and $3\times$ for $15\times$, and so
on. This means we end up with four elements relating $x_1$ and $z_1$ in the
composite. The apex of the composite is in fact given by the pullback $N
\times_Y M$ of the cospan $N \xrightarrow{o_Y} Y \xleftarrow{i_Y} M$ in
$\FinSet$.

Here we again see the problem of decorated cospans: the composite of the above
puts decorations on $N\times_Y M$, which can be of much larger cardinality than
$N$ and $M$. We wish to avoid the size of our decorated cospan from growing so
fast. Moreover, from our open systems perspective, we care not about the path
but by the total amplification of the signal from some chosen input to some
chosen output. The intuition is that if we black box the system, then we cannot
tell what paths the signal took through the system, only the total amplification
from input to output.

We thus want to restrict our apex to contain at most one point for each
input--output pair $(x,y)$, pushing the decoration along the quotient map $e$ in
the epi-mono factorisation of the function $N\times_YM \stackrel{e}\to
\overline{N\times_YM} \stackrel{m}\to X \times Z$. Put another way, we want
the category of decorated corelations, not decorated cospans. Represented as
decorated corelations, the above composite becomes
\[
    \tikzset{every path/.style={line width=.8pt}}
    \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (-2.5, 1.5) {};
		\node [style=sdot] (1) at (-2.5, -0) {};
		\node [style=sdot] (2) at (-2.5, -1.5) {};
		\node [style=amp] (3) at (-0.75, 1.5) {$6$};
		\node [style=amp] (4) at (-0.75, -1) {$-2$};
		\node [style=amp] (5) at (-0.75, 0.25) {$2.1$};
		\node [style=amp] (6) at (-0.75, -0.25) {$-0.4$};
		\node [style=sdot] (7) at (1, -0.5) {};
		\node [style=sdot] (8) at (4.5, 0.5) {};
		\node [style=sdot] (9) at (1, -1.5) {};
		\node [style=sdot] (10) at (4.5, -1.5) {};
		\node [style=amp] (11) at (2.75, -0.5) {$-1$};
		\node [style=amp] (12) at (2.75, -1.5) {$-2.3$};
		\node [style=amp] (13) at (2.75, 1.5) {$4$};
		\node [style=sdot] (14) at (4.5, 1.5) {};
		\node [style=amp] (15) at (2.75, -0) {$3$};
		\node [style=sdot] (16) at (4.5, -0.5) {};
		\node [style=sdot] (17) at (1, 0.5) {};
		\node [style=sdot] (18) at (1, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.west) to (0.center);
		\draw (5.west) to (1.center);
		\draw (6.west) to (1.center);
		\draw (4.west) to (2.center);
		\draw (14) to (13);
		\draw (16) to (11);
		\draw (12) to (10);
		\draw (9) to (12);
		\draw (13) to (18);
		\draw (3) to (18);
		\draw (5) to (17);
		\draw (6) to (7);
		\draw (4) to (7);
		\draw (11) to (7);
		\draw (17) to (15);
		\draw (15) to (16);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\qquad = \qquad
\begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (-2.5, 1.5) {};
		\node [style=sdot] (1) at (-2.5, -0) {};
		\node [style=sdot] (2) at (-2.5, -1.5) {};
		\node [style=amp] (3) at (-0.75, 1.5) {$24$};
		\node [style=amp] (4) at (-0.75, -1) {$2$};
		\node [style=amp] (5) at (-0.75, -0.25) {$6.7$};
		\node [style=sdot] (6) at (1, -0.5) {};
		\node [style=sdot] (7) at (1, -1.5) {};
		\node [style=sdot] (8) at (1, 0.5) {};
		\node [style=sdot] (9) at (1, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.west) to (0.center);
		\draw (5.west) to (1.center);
		\draw (4.west) to (2.center);
		\draw (3) to (9);
		\draw (5) to (6);
		\draw (4) to (6);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\]
Note that composite is not simply the composite as decorated cospans, but the
composite decorated cospan reduced to a decorated corelation. We will we show
that this decorated corelations category is equivalent to the category of real
vector spaces and linear maps, with monoidal product the tensor product.

We prove two main theorems in this section. The first is that these decorated
cospans do form a hypergraph category. That is, given a category $\mc C$ with
finite colimits, factorisation system $(\mc E,\mc M)$ such that $\mc M$ is
stable under pushouts, and a lax symmetric monoidal functor 
\[
  F\maps \mc C; \mc M^\opp \longrightarrow \Set,
\]
we may define a hypergraph category $F\mathrm{Corel}$ with objects those of $\mc
C$ and morphisms decorated corelations. As usual, functors between these
so-called decorated corelations categories can be defined from natural
transformations between these functors.

The second major theorem is that every hypergraph category and hypergraph
functor can be constructed in this way. This shows our decorated corelations
construction is as general as we need for the study of hypergraph categories,
and hence network-style diagrammatic languages.


\section{Decorated corelations} \label{sec:dcorc}

The key difference is to decorate cospans we need to know how to push
decorations up. To decorate corelations we all need to know how to pull
decorations back down. This is related to the existence of an extraspecial
commutative Frobenius monoid in our main applications.



\subsection{Adjoining right adjoints}

Suppose we have a cospan $X+Y \to N$ with a decoration on $N$. Reducing this to
a corelation requires us to factor this to $X+Y \stackrel{e}\to \overline{N}
\stackrel{m}\to N$. To define a category of decorated corelations, then, we must
specify how to take decoration on $N$ and `pull it back' along $m$ to a decoration on
$\overline{N}$.

For decorated cospans, it is enough to have a functor $F$ from a category $\mc C$
with finite colimits; the image $Ff$ of morphisms $f$ in $\mc C$ describes how
to move decorations forward along $f$. In this subsection we explain how to
expand $\mc C$ to include morphisms $m^\opp$ for each $m \mc C$, so that the
image of $m^\opp$ describes how to move morphisms backwards along $m$.

\begin{proposition}
  Let $\mathcal C$ be a category with finite colimits, and let $\mathcal M$ be a
  subcategory of $\mathcal C$ stable under pushouts. Then we define the category
  $\mathcal C; \mathcal M^\opp$ as follows  
  \smallskip 

  \begin{center}
    \begin{tabular}{| c | p{.65\textwidth} |}
      \hline
      \multicolumn{2}{|c|}{The symmetric monoidal category $(\mc C;\mc M^\opp,+)$} \\
      \hline
      \textbf{objects} & the objects of $\mathcal C$ \\ 
      \textbf{morphisms} & isomorphism classes of cospans of the form
      $\stackrel{c}\rightarrow \stackrel{m}\leftarrow$, where $c$ lies in
      $\mathcal C$ and $m$ in $\mathcal M$\\ 
      \textbf{composition} & given by pushout \\
      \textbf{monoidal product} & the coproduct in $\mathcal C$ \\
      \textbf{coherence maps} & the coherence maps in $\mc C$ \\
      \hline
    \end{tabular}
  \end{center}
  \smallskip 
\end{proposition}

\begin{proof}
  This is a symmetric monoidal subcategory of $\cospan(\mc C)$. Our data is
  well defined: composition because $\mc M$ is stable under pushouts, and
  monoidal composition by Lemma \ref{lem.mcoproductsmc}. 
\end{proof}

This category can be viewed as a bicategory, with 2-morphisms given by maps of
cospans. In this bicategory every morphism of $\mc M$ has a right adjoint.

\begin{examples} 
  Our familiar examples:
  \begin{itemize}
    \item $\mathcal C; \mathcal C^\opp$ is by definition equal to
$\cospan(\mathcal C)$.
\item $\mathcal C;\mathcal I_{\mathcal C}^\opp$ is
naturally isomorphic to $\mathcal C$.
\item $\Set;\mathrm{Inj}^\opp$ is the category of partial functions.
\end{itemize}
\end{examples}

\begin{lemma} \label{lem.madjointsfunctor}
  Let $\mathcal C$, $\mathcal C'$ be categories with finite colimits, and let
  $\mathcal M$, $\mathcal M'$ be subcategories each stable under pushouts. Let
  $A\maps \mathcal C \to \mc C'$ be functor that preserves colimits and such
  that the image of $\mc M$ lies in $\mc M'$. Then $A$ extends to a symmetric
  strong monoidal functor
  \[
    A\maps \mc C;\mc M^\opp \longrightarrow \mc C'; \mc M'^\opp.
  \]
  mapping $X$ to $AX$ and $\stackrel{c}\rightarrow \stackrel{m}\leftarrow$ to
  $\stackrel{Ac}\rightarrow \stackrel{Am}\leftarrow$.
\end{lemma}
\begin{proof}
  Note $A(\mc M) \subseteq \mc M'$, so $\stackrel{Ac}\rightarrow
  \stackrel{Am}\leftarrow$ is indeed a morphism in $\mc C';\mc M'^\opp$. This is
  then a restriction and corestriction of the usual functor $\cospan(\mc C) \to
  \cospan(\mc C')$ to the above domain and codomain.
\end{proof}

That this `subcospan category' construction could be defined more
generally using any two isomorphism-containing wide subcategories stable under
pushout, but the above suffices for decorated corelations. 

\subsection{Decorated corelations}
Decorated corelations are constructed from a lax monoidal functor from $\mc
C;\mc M^\opp$ to $\Set$.

\begin{definition}
  Let $\mathcal C$ be a category with finite colimits, and let $(\mathcal E,
  \mathcal M)$ be a factorisation system on $\mathcal C$. Suppose we also
  have a lax monoidal functor
  \[
    F: (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\Set, \times).
  \]
  We define an $F$-\define{decorated corelation} to a pair
  \[
    \left(
    \begin{aligned}
      \xymatrix{
	& N \\  
	X \ar[ur]^{i} && Y \ar[ul]_{o}
      }
    \end{aligned}
    ,
    \qquad
    \begin{aligned}
      \xymatrix{
	FN \\
	1 \ar[u]_{s}
      }
    \end{aligned}
    \right)
  \]
  where the cospan is jointly $\mathcal E$-like. A morphism of decorated
  corelations is a morphism of decorated cospans between two decorated
  corelations.
\end{definition}

Suppose we have decorated corelations
\[
  \left(
  \begin{aligned}
    \xymatrix{
      & N \\  
      X \ar[ur]^{i} && Y \ar[ul]_{o}
    }
  \end{aligned}
  ,
  \qquad
  \begin{aligned}
    \xymatrix{
      FN \\
      1 \ar[u]_{s}
    }
  \end{aligned}
  \right)
  \qquad
  \mbox{and}
  \qquad
  \left(
  \begin{aligned}
    \xymatrix{
      & M \\  
      Y \ar[ur]^{i} && Z \ar[ul]_{o}
    }
  \end{aligned}
  ,
  \qquad
  \begin{aligned}
    \xymatrix{
      FM \\
      1 \ar[u]_{s}
    }
  \end{aligned}
  \right).
\]
Then their composite is given by the composite corelation
\[
  \xymatrix{
    & \overline{N+_YM} \\  
    X \ar[ur]^{i} && Z \ar[ul]_{o}
  }
\]
paired with the decoration
\[
  1 \longrightarrow F(N+M) \longrightarrow F(N+_YM) \stackrel{F(m^\opp)}\longrightarrow F(\overline{N+_YM})
\]
As composition of corelations and decorated cospans are both well defined up to
isomorphism, this too is well defined up to isomorphism. Again, we will be lazy
about the distinction between a decorated corelation and its isomorphism class.


\subsection{Categories of decorated corelations}
In this subsection we give a definition of the hypergraph category
$F\mathrm{Corel}$ of decorated corelations.  In analogy with how we defined the
hypergraph category of corelations, we leverage the fact that decorated cospans
form a hypergraph category, this time using a structure preserving map 
\[
  \square\maps F\mathrm{Cospan} \longrightarrow F\mathrm{Corel}.
\]
Here $F\mathrm{Cospan}$ denotes the decorated cospan category constructed from
the restriction of the functor $F\maps \mc C;\mc M^\opp \to \Set$ to the domain
$\mc C$. 

Given a cospan $X \to N \leftarrow Y$, write $m\maps \overline{N} \to N$ for the
$\mc M$ factor of the copairing $X+Y \to N$. The functor $\square$ takes a
decorated cospan 
\[
  (X \stackrel{i}\longrightarrow N \stackrel{o}\longleftarrow Y, \enspace 1
    \stackrel{s}\longrightarrow FN)
\]
to the decorated corelation 
\[
  (X \stackrel{\overline{i}}\longrightarrow \overline N
  \stackrel{\overline{o}}{\longleftarrow} Y, \enspace 1 \xrightarrow{Fm^\opp \circ
  s} F\overline{N}),
\]
where the corelation is given by the jointly $\mc E$-part of the cospan, and the
decoration is given by composing $s$ with the $F$-image $Fm^\opp\maps FN \to
F\overline{N}$ of the map $N \stackrel{1_N}\to N \stackrel{m}\leftarrow
\overline{N}$ in $\mc C;\mc M^\opp$. We call $Fm^\opp \circ s$ the
\define{restricted decoration} of the decorated cospan $(X \to N \leftarrow Y,
\enspace 1 \stackrel{s}\to FN)$.

The monoidal product of two decorated corelations is their monoidal product as
decorated cospans.

\begin{theorem} \label{thm.fcorel}
  Let $\mathcal C$ be a category with finite colimits and factorisation system
  $(\mathcal E, \mathcal M)$ with $\mathcal M$ stable under pushout, and let 
  \[
    F: (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\Set, \times)
  \]
  be a lax symmetric monoidal functor.  Then we may define 
  \smallskip 

  \begin{center}
    \begin{tabular}{| c | p{.65\textwidth} |}
      \hline
      \multicolumn{2}{|c|}{The hypergraph category $(F\mathrm{Corel},+)$} \\
      \hline
      \textbf{objects} & the objects of $\mathcal C$ \\ 
      \textbf{morphisms} & isomorphism classes of $F$-decorated corelations in
      $\mathcal C$\\ 
      \textbf{composition} & given by $\mc E$-part of pushout with restricted
      decoration  \\
      \textbf{monoidal product} & the coproduct in $\mathcal C$  \\
      \textbf{coherence maps} & maps from $\cospan(\mc C)$ with restricted empty
      decoration \\
      \textbf{hypergraph maps} & maps from $\cospan(\mc C)$ with restricted empty
      decoration \\
      \hline
    \end{tabular}
  \end{center}
  \smallskip 
\end{theorem}

Similar to the corelations theorem (Theorem \ref{thm.cospantocorel}), we have
specified well-defined data and now need to check a collection of coherence
axioms. As before, we prove this alongside the theorem about decorated
corelation functors in the next section.

\begin{example}
  Note that decorated cospans are a special case of decorated corelations:
  simply use an morphism--isomorphism factorisation system.
\end{example}

\begin{example} \label{ex.undeccorel}
  Note that `undecorated' corelations are a special case of decorated
  corelations: they are corelations decorated by the functor $1\maps \mc C;\mc
  M^\opp \to \Set$ that maps each object to the one element set $1$, and each
  morphism to the identity function on $1$. This is a symmetric monoidal functor
  with the coherence maps all also the identity function on $1$.
\end{example}


%Associativity: To take a decoration on $A+B$ to one on $A+_C\overline B$ we may
%either reduce to the $\mathcal E$-part of $B$ and then pushout over $C$, or
%pushout over $C$ and then reduce to the $\mathcal E$ part of $B$. This lemma
%implies that both processes result in the same decoration.  i

\section{Functors between decorated corelation categories}
Functors between decorated corelation categories hold no surprises: their
requirements combine the requirements of corelations and decorated cospans.
Recall that Lemma \ref{lem.madjointsfunctor} says that we can extend a
colimit-preserving functor $\mc C \to \mc C'$ to a symmetric monoidal functor
$\mc C;\mc M^\opp \to \mc C';\mc M'^\opp$.

\begin{proposition}\label{prop.deccorelfunctors}
  Let $\mathcal C$, $\mathcal C'$ have finite colimits and respective
factorisation systems $(\mathcal E, \mathcal M)$, $(\mathcal E', \mathcal M')$,
such that $\mathcal M$ and $\mathcal M'$ are stable under pushout, and suppose
that we have lax symmetric monoidal functors
\[
  F: (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\Set, \times)
\]
and
\[
  G: (\mathcal C';\mathcal M'^\opp,+) \longrightarrow (\Set, \times).
\]

Further let $A\maps \mathcal C \to \mathcal C'$ be a functor that preserves
finite colimits and such that the image of $\mathcal M$ lies in $\mathcal M'$.
This functor $A$ extends to a symmetric monoidal functor $\mc C;\mc M^\opp \to
\mc C';\mc M'^\opp$.

Suppose we have a monoidal natural transformation $\theta$:
\[
  \xymatrixrowsep{2ex}
  \xymatrix{
    \mc C; \mc M^\opp \ar[dd]_{A} \ar[drr]^F  \\
    &\twocell \omit{_\:\theta}& \Set \\
    \mc C'; \mc {M'}^\opp \ar[urr]_{G} 
  }
\]

Then we may define a hypergraph functor $T\maps F\mathrm{Corel} \to
G\mathrm{Corel}$ sending each object $X \in F\mathrm{Corel}$ to $AX \in
G\mathrm{Corel}$ and each decorated corelation 
\[
  (X \stackrel{i_X}{\longrightarrow} N \stackrel{o_Y}{\longleftarrow} Y, \quad
  1 \stackrel{s}{\to} FN)
\]
to
\[
  (AX \stackrel{Ai_X}{\longrightarrow} \overline{AN} \stackrel{Ao_Y}{\longleftarrow} AY,
  \quad 1 \stackrel{s}{\to} FN \stackrel{\theta_N}{\to} GAN
  \xrightarrow{Gm_{AN}^\opp} G\overline{AN}).
\]
The coherence maps $\overline{\kappa_{X,Y}})$ are given by the coherence maps of $A$ with the restricted empty decoration.
\end{proposition}
\begin{proof}[Proof of Theorem \ref{thm.fcorel} and Proposition
  \ref{prop.deccorelfunctors}]
  In the proof of Theorem \ref{thm.cospantocorel} and Proposition
  \ref{prop.corelfunctors} we proved that the map 
  \[
    \square\maps \corel(\mc C) \longrightarrow \corel(\mc C')
  \]
  preserved composition and had natural coherence maps. Specialising to the case
  when $\corel(\mc C)=\cospan(\mc C')$, we saw that this bijective-on-objects,
  surjective-on-morphisms, composition and monoidal product preserving map
  proved $\corel(\mc C')$ is a hypergraph category, and it immediately followed
  that $\square$ is a hypergraph functor.

  The analogous argument holds here: we simply need to prove
  \[
    \square\maps F\corel \longrightarrow G\corel
  \]
  preserves composition and has natural coherence maps. Theorem \ref{thm.fcorel}
  then follows from examining the map $F\cospan \to F\corel$ obtained by
  choosing $\mc C = \mc C'$, $(\mc E,\mc M) = (\mc C', \mc I_{\mc C'})$, $F$ the
  restriction of $G$ to $\mc C'$, $A$ the identity functor on $\mc C'$, and
  $\theta$ the identity natural transformation. Subsequently Proposition
  \ref{prop.deccorelfunctors} follows from noting that all the axioms hold for
  the corresponding maps in $G\mathrm{Cospan}$.
  
  \paragraph{$\square$ preserves composition.} Suppose we have decorated corelations
  \[
    f=(X \stackrel{i_X}{\longrightarrow} N \stackrel{o_Y}{\longleftarrow} Y,
    \enspace 1 \stackrel{s}{\to} FN)
    \qquad
    \mbox{and}
    \qquad 
    g=(Y \stackrel{i_Y}{\longrightarrow} M \stackrel{o_Y}{\longleftarrow} Z,
    \enspace 1 \stackrel{t}{\to} FM)
  \]
%  \[
%    \left(
%    \begin{aligned}
%      \xymatrix{
%	& N \\  
%	X \ar[ur]^{i} && Y \ar[ul]_{o}
%      }
%    \end{aligned}
%    ,
%    \qquad
%    \begin{aligned}
%      \xymatrix{
%	FN \\
%	1 \ar[u]_{s}
%      }
%    \end{aligned}
%    \right)
%    \qquad
%    \mbox{and}
%    \qquad
%    \left(
%    \begin{aligned}
%      \xymatrix{
%	& M \\  
%	Y \ar[ur]^{i} && Z \ar[ul]_{o}
%      }
%    \end{aligned}
%    ,
%    \qquad
%    \begin{aligned}
%      \xymatrix{
%	FM \\
%	1 \ar[u]_{s}
%      }
%    \end{aligned}
%    \right).
%  \]
  We know the functor $\square$ preserves composition on the cospan part; this
  is precisely the content of Proposition \ref{prop.corelfunctors}. It remains to
  check that $\square( g \circ f)$ and $\square g \circ \square f$ have
  isomorphic decorations. This is expressed by the commutativity of the
  following diagram:
  \[
    \xymatrixrowsep{1.1pc}
    \xymatrixcolsep{.6pc}
    \xymatrix{
      \scriptstyle G\overline{A(\overline{N+_YM})} \ar[rrrrrr]^{Gn} &&&&&&
      \scriptstyle G\overline{(\overline{AN}+_{AY}\overline{AM})}\\
      \\
      \scriptstyle GA(\overline{N+_YM}) \ar[uu]^{Gm^\opp_{A(\overline{N+_YM})}} &&&
      \textsc{\tiny($\ast\ast$)} &&& 
      \scriptstyle G(\overline{AN}+_{AY}\overline{AM})
      \ar[uu]_{Gm^\opp_{\overline{AN}+_{AY}\overline{AM}}} \\
      \\
      \scriptstyle F(\overline{N+_YM}) \ar[uu]^{\theta_{\overline{N+_YM}}} &
      %\textsc{\tiny()} & 
      &
      \scriptstyle GA(N+_YM) \ar[uull]_{GAm^\opp_{N+_YM}} && 
      \scriptstyle G(AN+_{AY}AM) \ar[ll]_{G\sim} \ar[uurr]^{G(m_{AN}^\opp
      +_{AY}m_{AM}^\opp)\phantom{spac}}
      & \textsc{\tiny(c)} & 
      \scriptstyle G(\overline{AN}+\overline{AM})
      \ar[uu]_{G[j_{\overline{AN}},j_{\overline{AM}}]} 
      \\
      &\textsc{\tiny(tn)}&& \textsc{\tiny(a)} 
      \\
      \scriptstyle F(N+_YM) \ar[uu]^{Fm_{N+_YM}^\opp}
      %\ar[uurr]_{\theta_{N+_YM}} & \textsc{\tiny()} & 
      &&
      \scriptstyle GA(N+M)\ar[uu]_{GA[j_N,j_M]} && 
      \scriptstyle G(AN+AM) \ar[uu]^{G[j_{AN},j_{AM}]} \ar[ll]^{G\alpha_{N,M}}
      \ar[uurr]^(.6){G(m_{AN}^\opp +m_{AM}^\opp)\phantom{s}} & \textsc{\tiny(gm)} & 
      \scriptstyle G\overline{AN} \times G\overline{AM}
      \ar[uu]_{\gamma_{\overline{AN},\overline{AM}}} \\
      \\
      \scriptstyle F(N+M) \ar[uu]^{F[j_N,j_M]} \ar[uurr]_{\theta_{N+M}} &&&
      \textsc{\tiny(tm)} &&& 
      \scriptstyle GAN \times GAM \ar[uu]_{Gm_{AN}^\opp \times Gm_{AM}^\opp}
      \ar[uull]^{\gamma_{AN,AM}} \\
      \\
      &&&
      \scriptstyle FN \times FM \ar[uulll]^{\varphi_{N,M}}
      \ar[uurrr]_{\theta_N \times \theta_M} \\\\
      &&&
      \scriptstyle 1 \ar[uu]_{\rho_1\circ (s \times t)}
    }
  \]
  This diagram does indeed commute. To check this, first observe that \textsc{(tm)}
  commutes by the monoidality of $\theta$, \textsc{(gm)} commutes by the
  monoidality of $G$, and \textsc{(tn)} commutes by the naturality of $\theta$.
  The remaining three diagrams commute as they are $G$-images of diagrams that
  commute in $\mc C';\mc M'^\opp$. Indeed, \textsc{(a)} commutes since $A$ preserves
  colimits and $G$ is functorial, \textsc{(c)} commutes as it is the $G$-image
  of a pushout square in $\mc C'$, so 
  \[
    \xleftarrow{m_{AN}+m_{AM}}
    \xrightarrow{[j_{\overline{AN}},j_{\overline{AM}}]}
    \quad 
    \textrm{and}
    \quad
    \xrightarrow{[j_{AN},j_{AM}]}
    \xleftarrow{m_{AN}+_{AY}m_{AM}} 
  \]
  are equal as morphisms of $\mc C';\mc M'^\opp$, and \textsc{($\ast\ast$)}
  commutes as it is the $G$-image of the right-hand subdiagram of
  (\ref{diag.eparts}) used to define $n$ in the proof of Lemma
  \ref{lem.corelfuncomposition}.

  \paragraph{Coherence maps are natural.}
  Let $f = (X \longrightarrow N \longleftarrow Y, \enspace 1 \to FN)$, $g= (Z
  \longrightarrow M \longleftarrow W, \enspace 1 \to FM)$ be $F$-decorated
  corelations in $\mc C$. We wish to show that
  \[
    \xymatrixcolsep{4pc}
    \xymatrixrowsep{2pc}
    \xymatrix{
      AX+AY \ar[r]^{\square f+\square g}
      \ar[d]_{\overline{\kappa_{X,Y}}} & 
      AZ+AW \ar[d]^{\overline{\kappa_{Z,W}}} \\
      A(X+Y) \ar[r]^{\square(f+g)} & A(Z+W)
    }
  \]
  commutes in $G\mathrm{Corel}$, where the coherence maps are given by
  \[
    \overline{\kappa_{X,Y}}=          
    \left(
    \begin{aligned}
      \xymatrix{
	& \overline{A(X+Y)} \\  
	AX+AY \ar[ur] && A(X+Y) \ar[ul]
      }
    \end{aligned}
    ,
    \qquad
    \begin{aligned}
      \xymatrixrowsep{1.4ex}
      \xymatrix{
	G(\overline{A(X+Y)}) \\
	GA(X+Y) \ar[u]_{Gm_{AX+AY}^\opp} \\
	G\varnothing \ar[u]_{G!} \\
	1 \ar[u]_{\gamma_1}
      }
    \end{aligned}
    \right).
  \]
  Lemma \ref{lem.corelfunmonoidal} shows that the composites of corelations
  agree. It remains to check that the decorations also agree.

  Here Lemma \ref{lem.emptydecorations} is helpful. Since $\square$ is
  composition preserving, we can replace the $\overline{\kappa}$ with the empty
  decorated coherence maps $\kappa$ of $G\mathrm{Cospan}$, and compute these
  composites in $G\mathrm{Cospan}$, before restricting to the $\mc E'$-parts.
  Lemma \ref{lem.emptydecorations} then implies that the restricted empty
  decorations on the isomorphisms $\overline{\kappa}$ play no role in
  determining the composite decorations. It is thus enough to prove that the
  decorations of $\square f + \square g$ and $\square(f+g)$ are the same up to
  the isomorphism $p\maps G(\overline{AN} +\overline{AM}) \to
  G\overline{A(N+M)}$ between their apices, as defined in the diagram
  (\ref{diag.natural}) in the proof of Lemma \ref{lem.corelfunmonoidal}.

  This comes down to proving the following diagram commutes:
  \[
    \xymatrixrowsep{.8pc}
    \xymatrixcolsep{.8pc}
    \xymatrix{
      &&&& 
      GAN \times GAM \ar[rrdd]^{\gamma} \ar[rr]^{Gm \times Gm} && 
      G\overline{AN} \times G\overline{AM} \ar[rr]^{\gamma} && 
      G(\overline{AN}+\overline{AM}) \ar[dddd]^{Gp}_\sim \\ 
      &&&&&& 
      \textrm{\tiny(G)} \\
      1 \ar[rr]^(.4){\langle s,t \rangle} && 
      FN\times FM \ar[uurr]^{\theta} \ar[ddrr]_{\varphi} && 
      \textrm{\tiny(T)} && 
      G(AN+AM) \ar[uurr]^{G(m+m)} \ar[dd]_{G\kappa} \\
      &&&&&&& 
      \textrm{\tiny(\#\#)}\\ 
      &&&& 
      F(N+M) \ar[rr]_{\theta} && 
      GA(N+M) \ar[rr]_{Gm} && 
      G\overline{A(N+M)}
    }
  \]
  It is straightforward to check this commutes: (T) by the monoidality of
  $\theta$, (G) by the monoidality of $G$, and (\#\#) as it is the $G$-image of
  the rightmost square in (\ref{diag.natural}).
\end{proof}

%  \[
%    \xymatrixrowsep{1pc}
%    \xymatrixcolsep{1pc}
%    \xymatrix{
%      &&&& F(N+M) \ar[dd]^{F((m_N +m_M)^\opp)} \ar[rr]^{F[j_N,j_M]} 
%      && F(N+_YM) \ar[dd]^{F((m_N+_Ym_M)^\opp)} \ar[rr]^{F((m_{N+_YM})^\opp)} 
%      && F(\overline{N+_YM}) \ar[dd]^{Fn}_\sim \\ 
%      1 \ar[rr]^(.4){(s\times t)\circ\lambda^{-1}} 
%      && FN\times FM \ar[urr]^{\varphi} \ar[dr]_{Fm_N^\opp\times Fm_M^\opp} &
%      \qquad\textrm{\tiny(I)}% && \textrm{\tiny(F)} && \textrm{\tiny(C)}
%      \\ 
%      &&& F\overline{N} \times F\overline{M} \ar[r]_{\varphi} 
%      & F(\overline{N}+\overline{M})
%      \ar[rr]_{F[j_{\overline{N}},j_{\overline{M}}]} 
%      && F(\overline{N}+_Y\overline{M})
%      \ar[rr]_{F((m_{\overline{N}+_Y\overline{M}})^\opp)} 
%      && F(\overline{\overline{N}+_Y\overline{M}})
%    }
%  \]
%  Here $n$ is the isomorphism from the proof of Proposition
%  \ref{prop.corelfunctors}.
%  The leftmost square (I) commutes by the naturality of $\varphi$, the central
%  square commutes as it is the $F$-image of a pushout square in $\mathcal C$,
%  and rightmost square commutes as it is the $F$-image of the rightmost square
%  in the commutative diagram (\ref{diag.eparts}) in $\mathcal M^\opp$.
  


\begin{corollary}
  Let $\mathcal C$ be a category with finite colimits, and let $(\mathcal E,
  \mathcal M)$ be a factorisation system on $\mathcal C$. Suppose that we also
  have a lax monoidal functor
  \[
    F: (\mathcal C;\mathcal M^\opp,+) \longrightarrow (\Set, \times).
  \]
  Then we may define a category $F\mathrm{Corel}$ with objects the objects of
  $\mathcal C$ and morphisms isomorpism classes of $F$-decorated corelations.

  Write also $F$ for the restriction of $F$ to the wide subcategory $\mathcal
  C$ of $\mathcal C;\mathcal M^\opp$. We can thus also obtain the category
  $F\mathrm{Cospan}$ of
  $F$-decorated cospans. We moreover have a functor 
  \[
    F\mathrm{Cospan} \to F\mathrm{Corel}
  \]
  which takes each object of $F\mathrm{Cospan}$ to itself as an object of
  $F\mathrm{Corel}$, and each decorated cospan
  \[
    \left(
    \begin{aligned}
      \xymatrix{
	& N \\  
	X \ar[ur]^{i} && Y \ar[ul]_{o}
      }
    \end{aligned}
    ,
    \qquad
    \begin{aligned}
      \xymatrix{
	FN \\
	1 \ar[u]_{s}
      }
    \end{aligned}
    \right)
  \]  
  to its jointly $\mathcal E$-part
  \[
    \xymatrix{
      & \overline{N} \\  
      X \ar[ur]^{i} && Y \ar[ul]_{o}
    }
  \]
  decorated by the composite
  \[
    \xymatrix{
      1 \ar[r]^s & FN \ar[r]^{Fm_N^\opp} & F\overline{N}.
    }
  \]
\end{corollary}


\section{All hypergraph categories are decorated corelation categories}

Not all hypergraph categories are decorated \emph{cospan} categories. To see
this, we can count morphisms. In a decorated cospan category, the set of
morphisms from $X$ to $Y$ always comprises all decorated cospans $(X \to N
\leftarrow Y,\enspace 1 \to FN)$. Now for any object $N$ in the underlying
category $\mc C$, there is a unique morphism $\varnothing \to N$. This means
that the morphisms $\varnothing \to \varnothing$ are indexed by elements of
$FN$, ranging over $N$.

Suppose we have a decorated cospan category with a unique morphism $\varnothing
\to \varnothing$. By the previous paragraph, this implies there is only one
object $N$ such that $FN$ is nonempty. But $FN$ must always contain at least one
element, the empty decoration $1 \xrightarrow{\varphi_I} F\varnothing
\xrightarrow{F!} FN$. This implies there is only one object $N$ in $\mc C$: the
object $\varnothing$. Thus $\mc C$ must be the one object discrete category, and
$F\maps \mc C \to \Set$ is the functor that sends the object of $\mc C$ to the
one element set $1$.

Hence any decorated cospan category with a unique morphism $\varnothing \to
\varnothing$ is also the one object discrete category. But the hypergraph
category of finite sets and equivalence relations, discussed in Subsection
\ref{ssec.equivrels}, has a unique morphism $\varnothing \to \varnothing$.  Thus
not every hypergraph category can be constructed as a decorated cospan category.

Decorated corelation categories, however, are more powerful. In this section we
show that all hypergraph categories are decorated corelation categories, and
provide some examples for intuition.

\subsection{The global sections construction}
Suppose we have a hypergraph category and wish to construct a hypergraph
equivalent decorated corelation category. The main idea to is to take advantage
of the compact closed structure: recall that morphisms $X \to Y$ in a hypergraph
category are in one-to-one correspondence with morphisms $I \to X\ot Y$. Using
an isomorphism--morphism factorisation system on the category comprising just
the objects and the coherence and hypergraph maps, we can use the monoidal
global sections functor to decorate each corelation $X \to X \ot Y \leftarrow
Y$ with the monoidal elements of $X\ot Y$. This recovers the original hypergraph
category.


\begin{theorem}\label{thm.hypdeccorcats}
  Every hypergraph category is hypergraph equivalent to a decorated corelation
  category.
\end{theorem}
\begin{proof}
  Let $(\mc H,\ot)$ be a hypergraph category. By Theorem
  \ref{thm.stricthypergraphs}, we have a hypergraph equivalent strict hypergraph
  category $\mc H_{\mathrm{str}}$, with objects finite lists of objects in $\mc
  H$. Write $\mc O$ for the collection of objects in $\mc H$, and $\FinSet_{\mc
  O}$ for $\mc O$-labelled finite sets (i.e. an object is a finite set $S$
  together with each element in $S$ labelled by some object in $\mc O$, and a
  morphism is a function that preserves labels). The category $\FinSet_{\mc O}$
  has finite colimits: the colimit is just the colimit set in $\FinSet$ with
  elements labelled by the label of any element that maps to it in the colimit
  diagram. This labelling exists and is unique by the universal property of the
  colimit. We consider $\FinSet_{\mc O}$ a symmetric monoidal category with
  the coproduct, which we write as $+$, as its monoidal product.  Replacing
  $\FinSet$ with an equivalent skeleton, we think of the objects of
  $\FinSet_{\mc O}$ as finite lists of objects of $\mc H$, and hence as the same
  as the objects of $\mc H_{\mathrm{str}}$.

  We define a hypergraph functor that is a wide embedding of categories
  \[
    H\maps (\cospan(\FinSet_{\mc O}),+) \longrightarrow (\mc
    H_{\mathrm{str}},\ot)
  \]
  whose `image' is the hypergraph structure of $\mc H$. More precisely, $H$
  sends each object of $\cospan(\FinSet_{\mc O})$ to the same as an object of
  $\mc H_{\mathrm{str}}$. As all functions can be generated under composition
  and coproduct from the unique functions $\mu \maps 2 \to 1$ and $\eta \maps 0
  \to 1$, the morphisms of $\FinSet_{\mc O}$ are generated by the unique
  morphisms $\mu_X\maps [X,X]=X+X \to X$ and $\eta_X\maps \varnothing \to X$,
  and so the morphisms of $\cospan(\FinSet_{\mc O})$ are generated by the
  cospans $\mu_X$, $\eta_X$, $\delta_X = \mu_X^\opp$, and $\epsilon_X =
  \eta_X^\opp$. The functor $H$ maps these generators to the corresponding
  Frobenius maps on $X$ in $\mc H_{\mathrm{str}}$. Since $\cospan(\FinSet)$ is
  the `generic special commutative monoid' (see Proposition
  \ref{prop.cospanscfm}), it is straightforward to check this defines a
  hypergraph functor.

  Next, recall that the monoidal global sections functor $\mc H(I,-)\maps \mc H
  \to \Set$ is a lax symmetric monoidal functor taking each object $X$ of $\mc
  H$ to the homset $\mc H(I,X)$, and recall we have a hypergraph equivalence
  $\mc H_{\mathrm{str}} \to \mc H$. Write $F$ for the composite of these three
  functors: 
  \[
    F\maps \cospan(\FinSet_{\mc O}) \stackrel{H}\longrightarrow \mc
    H_{\mathrm{str}} \stackrel{\sim}\longrightarrow \mc H \stackrel{\mc
    H(I,-)}\longrightarrow \Set
  \]
  This is lax symmetric monoidal functor mapping $X$ to the homset $\mc H(I,X)$,
  and a cospan between lists of objects in $\mc H$ to the corresponding
  Frobenius map.

  Now consider $\FinSet_{\mc O}$ with an (isomorphism,morphism)-factorisation
  system. This implies $F$ defines a decorated corelation category
  $F\mathrm{Corel}$ with objects those of $\mc H_{\mathrm{str}}$, and morphisms
  $X \to Y$ trivial corelations $X \xrightarrow{\iota_X} X+Y
  \xleftarrow{\iota_Y} Y$ decorated by some morphism $s \in \mc H(I,X\ot Y)$. We
  will show $(F\mathrm{Corel},+)$ and $(\mc H_{\mathrm{str}},\ot)$ are
  isomorphic as hypergraph categories.
  
  First, let us examine composition in $F\mathrm{Corel}$. As morphisms $X \to Y$
  are completely specified by their decoration $s \in \mc H(I,X\ot Y)$, we will
  abuse terminology and refer to the decorations themselves as the morphisms.
  Given morphisms $s \in \mc H(I,X\ot Y)$ and $t \in \mc H(I,Y\ot Z)$ in
  $F\mathrm{Corel}$, composition is given by the map 
  \[
    H(I,X\ot Y\ot Y\ot Z) \to H(I,X\ot Z)
  \]
  arising as the $F$-image of the cospan $X+Y+Y+Z
  \xrightarrow{[j_{X+Y},j_{Y+Z}]} X+Y+Z \xleftarrow{[\iota_X,\iota_Z]} X+Z$,
  where these maps come from the pushout square
  \[
    \xymatrix{
      && X+Y+Z \\
      & X+Y \ar[ur]^{j_{X+Y}} && Y+Z \ar[ul]_{j_{Y+Z}} \\
      X \ar[ur]^{\iota_X} && Y \ar[ul]_{\iota_Y} \ar[ur]^{\iota_Y} && Z
      \ar[ul]_{\iota_Z}
    }
  \]
  and the trivial isomorphism-morphism factorisation $X+Z = X+Z
  \xrightarrow{[\iota_X,\iota_Z]} X+Y+Z$ in $\FinSet_{\mc O}$.
  
  In terms of string diagrams in $\mc H$, this means composing the maps 
  \[
    \tikzset{every path/.style={line width=1.1pt}}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.25, 0.375) {};
		\node [style=none] (1) at (0.5, 0.375) {};
		\node [style=none] (2) at (-0.25, -0.375) {};
		\node [style=none] (3) at (0.5, -0.375) {};
		\node [style=none] (4) at (0.5, 0.25) {};
		\node [style=none] (5) at (0.5, -0.25) {};
		\node [style=none] (6) at (1.25, 0.25) {};
		\node [style=none] (7) at (1.25, -0.25) {};
		\node [style=none] (8) at (0.125, -0) {$s$};
		\node [style=none] (9) at (1.5, 0.25) {$X$};
		\node [style=none] (10) at (1.5, -0.25) {$Y$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
		\draw (1.center) to (3.center);
		\draw (3.center) to (2.center);
		\draw (2.center) to (0.center);
		\draw (4.center) to (6.center);
		\draw (5.center) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}
\qquad 
\qquad
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.25, 0.375) {};
		\node [style=none] (1) at (0.5, 0.375) {};
		\node [style=none] (2) at (-0.25, -0.375) {};
		\node [style=none] (3) at (0.5, -0.375) {};
		\node [style=none] (4) at (0.5, 0.25) {};
		\node [style=none] (5) at (0.5, -0.25) {};
		\node [style=none] (6) at (1.25, 0.25) {};
		\node [style=none] (7) at (1.25, -0.25) {};
		\node [style=none] (8) at (0.125, -0) {$t$};
		\node [style=none] (9) at (1.5, 0.25) {$Y$};
		\node [style=none] (10) at (1.5, -0.25) {$Z$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
		\draw (1.center) to (3.center);
		\draw (3.center) to (2.center);
		\draw (2.center) to (0.center);
		\draw (4.center) to (6.center);
		\draw (5.center) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}
  \]
  with the Frobenius map
  \[
    \tikzset{every path/.style={line width=1.1pt}}
    \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.125, 0.75) {};
		\node [style=none] (1) at (-0.125, 0.25) {};
		\node [style=none] (2) at (-0.125, -0.25) {};
		\node [style=none] (3) at (-0.125, -0.75) {};
		\node [style=none] (4) at (0.5, -0) {};
		\node [style=none] (5) at (1, 0.75) {};
		\node [style=none] (6) at (1, -0.75) {};
		\node [style=none] (8) at (-0.375, 0.75) {$X$};
		\node [style=none] (9) at (-0.375, 0.25) {$Y$};
		\node [style=none] (10) at (-0.375, -0.25) {$Y$};
		\node [style=none] (11) at (-0.375, -0.75) {$Z$};
		\node [style=none] (12) at (1.25, 0.75) {$X$};
		\node [style=none] (13) at (1.25, -0.75) {$Z$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (5.center);
		\draw [in=90, out=0, looseness=1.00] (1.center) to (4.center);
		\draw [in=-90, out=0, looseness=1.00] (2.center) to (4.center);
		\draw (3.center) to (6.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\quad
=
\quad
\begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.125, 0.75) {};
		\node [style=none] (1) at (-0.125, 0.25) {};
		\node [style=none] (2) at (-0.125, -0.25) {};
		\node [style=none] (3) at (-0.125, -0.75) {};
		\node [style=none] (4) at (0.5, -0) {};
		\node [style=none] (5) at (1.25, 0.75) {};
		\node [style=none] (6) at (1.25, -0.75) {};
		\node [style=circ2] (7) at (1, -0) {};
		\node [style=none] (8) at (-0.375, 0.75) {$X$};
		\node [style=none] (9) at (-0.375, 0.25) {$Y$};
		\node [style=none] (10) at (-0.375, -0.25) {$Y$};
		\node [style=none] (11) at (-0.375, -0.75) {$Z$};
		\node [style=none] (12) at (1.5, 0.75) {$X$};
		\node [style=none] (13) at (1.5, -0.75) {$Z$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (5.center);
		\draw [in=90, out=0, looseness=1.00] (1.center) to (4.center);
		\draw [in=-90, out=0, looseness=1.00] (2.center) to (4.center);
		\draw (3.center) to (6.center);
		\draw (4.center) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
  \]
  to get 
  \[
    \tikzset{every path/.style={line width=1.1pt}}
    \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.25, 0.375) {};
		\node [style=none] (1) at (0.5, 0.375) {};
		\node [style=none] (2) at (-0.25, -0.375) {};
		\node [style=none] (3) at (0.5, -0.375) {};
		\node [style=none] (4) at (0.5, 0.25) {};
		\node [style=none] (5) at (0.5, -0.25) {};
		\node [style=none] (6) at (1.25, 0.25) {};
		\node [style=none] (7) at (1.25, -0.25) {};
		\node [style=none] (8) at (0.125, -0) {$t\circ s$};
		\node [style=none] (9) at (1.5, 0.25) {$X$};
		\node [style=none] (10) at (1.5, -0.25) {$Z$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
		\draw (1.center) to (3.center);
		\draw (3.center) to (2.center);
		\draw (2.center) to (0.center);
		\draw (4.center) to (6.center);
		\draw (5.center) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\quad = 
\quad
\begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.875, 0.875) {};
		\node [style=none] (1) at (-0.125, 0.875) {};
		\node [style=none] (2) at (-0.125, 0.125) {};
		\node [style=none] (3) at (-0.875, 0.125) {};
		\node [style=none] (4) at (-0.875, -0.125) {};
		\node [style=none] (5) at (-0.125, -0.125) {};
		\node [style=none] (6) at (-0.125, -0.875) {};
		\node [style=none] (7) at (-0.875, -0.875) {};
		\node [style=none] (8) at (-0.125, 0.75) {};
		\node [style=none] (9) at (-0.125, 0.25) {};
		\node [style=none] (10) at (-0.125, -0.25) {};
		\node [style=none] (11) at (-0.125, -0.75) {};
		\node [style=none] (12) at (0.5, -0) {};
		\node [style=none] (13) at (0.75, 0.75) {};
		\node [style=none] (14) at (0.75, -0.75) {};
		\node [style=none] (15) at (-0.5, 0.5) {$s$};
		\node [style=none] (16) at (-0.5, -0.5) {$t$};
		\node [style=none] (17) at (1, 0.75) {$X$};
		\node [style=none] (18) at (1, -0.75) {$Z$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (0.center);
		\draw (4.center) to (5.center);
		\draw (5.center) to (6.center);
		\draw (6.center) to (7.center);
		\draw (7.center) to (4.center);
		\draw (8.center) to (13.center);
		\draw [in=90, out=0, looseness=1.00] (9.center) to (12.center);
		\draw [in=-90, out=0, looseness=1.00] (10.center) to (12.center);
		\draw (11.center) to (14.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\]
in $\mc H(I,X\ot Z)$. 

The monoidal product is given by
  \[
    \tikzset{every path/.style={line width=1.1pt}}
    \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.25, 0.375) {};
		\node [style=none] (1) at (0.5, 0.375) {};
		\node [style=none] (2) at (-0.25, -0.375) {};
		\node [style=none] (3) at (0.5, -0.375) {};
		\node [style=none] (4) at (0.5, 0.25) {};
		\node [style=none] (5) at (0.5, -0.25) {};
		\node [style=none] (6) at (1.25, 0.25) {};
		\node [style=none] (7) at (1.25, -0.25) {};
		\node [style=none] (8) at (0.125, -0) {$s$};
		\node [style=none] (9) at (1.5, 0.25) {$X$};
		\node [style=none] (10) at (1.5, -0.25) {$Y$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
		\draw (1.center) to (3.center);
		\draw (3.center) to (2.center);
		\draw (2.center) to (0.center);
		\draw (4.center) to (6.center);
		\draw (5.center) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\quad 
+
\quad
\begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.25, 0.375) {};
		\node [style=none] (1) at (0.5, 0.375) {};
		\node [style=none] (2) at (-0.25, -0.375) {};
		\node [style=none] (3) at (0.5, -0.375) {};
		\node [style=none] (4) at (0.5, 0.25) {};
		\node [style=none] (5) at (0.5, -0.25) {};
		\node [style=none] (6) at (1.25, 0.25) {};
		\node [style=none] (7) at (1.25, -0.25) {};
		\node [style=none] (8) at (0.125, -0) {$t$};
		\node [style=none] (9) at (1.5, 0.25) {$Z$};
		\node [style=none] (10) at (1.5, -0.25) {$W$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
		\draw (1.center) to (3.center);
		\draw (3.center) to (2.center);
		\draw (2.center) to (0.center);
		\draw (4.center) to (6.center);
		\draw (5.center) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\quad = \quad 
\begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-0.875, 0.875) {};
		\node [style=none] (1) at (-0.125, 0.875) {};
		\node [style=none] (2) at (-0.125, 0.125) {};
		\node [style=none] (3) at (-0.875, 0.125) {};
		\node [style=none] (4) at (-0.875, -0.125) {};
		\node [style=none] (5) at (-0.125, -0.125) {};
		\node [style=none] (6) at (-0.125, -0.875) {};
		\node [style=none] (7) at (-0.875, -0.875) {};
		\node [style=none] (8) at (-0.125, 0.75) {};
		\node [style=none] (9) at (-0.125, 0.25) {};
		\node [style=none] (10) at (-0.125, -0.25) {};
		\node [style=none] (11) at (-0.125, -0.75) {};
		\node [style=none] (12) at (1, 0.75) {};
		\node [style=none] (13) at (1, 0.25) {};
		\node [style=none] (14) at (1, -0.25) {};
		\node [style=none] (15) at (1, -0.75) {};
		\node [style=none] (16) at (-0.5, 0.5) {$s$};
		\node [style=none] (17) at (-0.5, -0.5) {$t$};
		\node [style=none] (18) at (1.25, 0.75) {$X$};
		\node [style=none] (19) at (1.25, 0.25) {$Z$};
		\node [style=none] (20) at (1.25, -0.25) {$Y$};
		\node [style=none] (21) at (1.25, -0.75) {$W$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
		\draw (1.center) to (2.center);
		\draw (2.center) to (3.center);
		\draw (3.center) to (0.center);
		\draw (4.center) to (5.center);
		\draw (5.center) to (6.center);
		\draw (6.center) to (7.center);
		\draw (7.center) to (4.center);
		\draw (8.center) to (12.center);
		\draw [in=180, out=0, looseness=1.00] (9.center) to (14.center);
		\draw [in=180, out=0, looseness=1.00] (10.center) to (13.center);
		\draw (11.center) to (15.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{aligned}
\]

  Taking a hint from the compact closed structure, the isomorphism between
  $F\mathrm{Corel}$ and $\mc H_{\mathrm{str}}$ is the clear: the functors act as
  the identity on objects, and on morphisms take $f: A \to B$ in $\mc H$ to its
  name $\hat f: I \to A+B$ as a morphism of $F\mathrm{Corel}$, and vice versa. 
  
  It is straightforward to check that these are strict hypergraph functors. To
  demonstrate the most subtle aspect, the Frobenius structure, we consider the
  multiplication on an object $X$ of $F\mathrm{Corel}$. To obtain this, we start
  with the multiplication in $F\mathrm{Cospan}$, the cospan $X+X
  \xrightarrow{[1,1]} X \xleftarrow{1} X$ decorated with the empty decoration,
  which in this case is $\eta_X \in \mc H(I,X)$, and restrict this empty
  decoration along the map $X \xleftarrow{[1,1,1]} X+X+X$. Thus the
  multiplication on $X$ in $F\mathrm{Corel}$ is 
  \[
    \tikzset{every path/.style={line width=1.1pt}}
    \begin{aligned}
      \begin{tikzpicture}[scale=.65]
	\begin{pgfonlayer}{nodelayer}
	  \node [style=none] (0) at (0.75, 0.5) {};
	  \node [style=dot] (1) at (0, -0) {};
	  \node [style=none] (2) at (0.75, -0.5) {};
	  \node [style=none] (3) at (1.5, 0.5) {$X$};
	  \node [style=none] (4) at (1.25, 0.5) {};
	  \node [style=none] (5) at (1.25, -0.5) {};
	  \node [style=dot] (6) at (-1.25, -0.5) {};
	  \node [style=none] (7) at (-0.5, -1) {};
	  \node [style=none] (8) at (1.25, -1) {};
	  \node [style=none] (9) at (-0.5, -0) {};
	  \node [style=dot] (10) at (-2, -0.5) {};
	  \node [style=none] (11) at (1.5, -0.5) {$X$};
	  \node [style=none] (12) at (1.5, -1) {$X$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
	  \draw [in=90, out=180, looseness=0.90] (0.center) to (1.center);
	  \draw [in=-90, out=180, looseness=0.90] (2.center) to (1.center);
	  \draw (4.center) to (0.center);
	  \draw (5.center) to (2.center);
	  \draw [in=90, out=180, looseness=0.90] (9.center) to (6);
	  \draw [in=-90, out=180, looseness=0.90] (7.center) to (6);
	  \draw (6) to (10.center);
	  \draw (8.center) to (7.center);
	  \draw (9.center) to (1);
	\end{pgfonlayer}
      \end{tikzpicture}
    \end{aligned}
    \in \mc H(I,X \ot X \ot X),
  \]
  which corresponds under our isomorphism to the map $\mu_X\maps X \ot X \to X
  \in \mc H_{\mathrm{str}}$, as required.
\end{proof}

We can also recover hypergraph functors using decorated corelations.

\begin{theorem} \label{thm.hypdeccorfunctors}
  All hypergraph functors are decorated corelation functors.
\end{theorem}
\begin{proof}
  Let $(T,\tau)\maps \mc H \to \mc H'$ be a hypergraph functor between
  hypergraph categories. The previous theorem implies there exist lax symmetric
  monoidal functors 
  \[
    F\maps \cospan(\FinSet_{\mc O}) \to \Set \quad \mbox{and} \quad F'\maps
    \cospan(\FinSet_{\mc O'}) \to \Set
  \]
  such that we have isomorphisms $\mc
  H_{\mathrm{str}} \cong F\mathrm{Corel}$ and $\mc H_{\mathrm{str}}' \cong
  F'\mathrm{Corel}$. We will realise $T$ as the functor induced by some
  colimit-preserving functor $A\maps \FinSet_{\mc O} \to \FinSet_{\mc O'}$ and
  monoidal natural transformation:
  \[
    \xymatrixrowsep{2ex}
    \xymatrix{
      \cospan(\FinSet_{\mc O}) \ar[dd]_{A} \ar[drr]^F  \\
      &\twocell \omit{_\:\theta}& \Set \\
      \cospan(\FinSet_{\mc O'}) \ar[urr]_{F'} 
    }
  \]

  Define the functor $A$ to take each $\mc O$-labelled set $[X_1,\dots,X_n]$ to
  the same set now $\mc O'$-labelled $[TX_1,\dots,TX_n]$, and to take a function
  between $\mc O$-labelled sets to the same function, noting that the function
  now preserves the $\mc O'$-labels. This functor $A$ clearly preserves
  colimits: again, colimits in $\FinSet_{\mc O}$ are just colimits in $\FinSet$
  with the labels inherited as described above.

  Let $S=[X_1,\dots,X_n]$ be an $\mc O$-labelled set. Then we define
  \begin{align*}
    \theta_S\maps \mc H(I,X_1 \ot \dots \ot X_n) &\longrightarrow \mc H'(I, TX_1
    \ot \dots \ot TX_n); \\
    \Big(I \stackrel{s}\to X_1\ot \dots \ot X_n\Big) &\longmapsto \Big(I
    \stackrel{\tau}\to TI \stackrel{Ts}\to T(X_1\ot \dots \ot X_n)
    \stackrel{\tau}\to TX_1 \ot \dots \ot TX_n\Big), 
  \end{align*}
  where the $\tau$ are the appropriate coherence isomorphisms of $T$. This
  collection of maps $\theta$ is natural as functions in $\FinSet_{\mc O}$ act
  as the Frobenius maps on the homsets $\mc H(I,X)$ and $\mc H'(I,TX)$, and the
  functor $T$ is hypergraph and so maps, loosely speaking, Frobenius maps to
  Frobenius maps. Moreover $\theta$ is monoidal as $T$ is monoidal.  Thus
  $\theta$ defines a monoidal natural transformation.

  The hypergraph functor $F\mathrm{Corel} \to F'\mathrm{Corel}$ induced by
  $\theta$ is by definition the map taking $s \in \mc H(I,X \ot Y)$ to
  $\tau^{-1} \circ Ts \circ \tau_1 \in \mc H'(I,TX \ot TY)$. Composing this
  functor with the appropriate equivalences we recover $T \maps \mc H \to \mc
  H'$.
\end{proof}

\subsection{A categorical equivalence}

Choose Grothendieck universes so that we may talk about categories $\Set$ now of
all `small' sets, and $\mathrm{Cat}$ of all `small' categories. If we restrict
our attention to small hypergraph categories, we map summarise these results as a categorical equivalence. 

Indeed, given some fixed object set $\mc O$, we have a category of lax symmetric
monoidal functors and monoidal natural transformations
\[
  \mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O}),\Set).
\]
This is equivalent to some subcategory of the category $\mathrm{HypCat}$ of
hypergraph categories. To get a category equivalent to $\mathrm{HypCat}$, we
must patch together these functor categories by varying the object set and
specifying morphisms from objects in one category to objects in another. For
this we use the Grothendieck construction. 

Given a (contravariant) functor $S\maps \mc B \to \mathrm{Cat}$ from some
category $\mc B$ to $\mathrm{Cat}$, we define the \define{(contravariant)
Grothendieck construction} $\mc B \int S$ to be the category with objects pairs
$(\mc O,F)$ where $\mc O$ is an object of $\mc B$ and $F$ is an object of $S\mc
O$, and morphisms pairs 
\[
  (f,\theta)\maps (\mc O,F) \longrightarrow (\mc O',F')
\]
where $f\maps \mc O \to \mc O'$ is a morphism in $\mc B$ and $\theta\maps F \to
Sr(F')$ is a morphism in $S\mc O$.

Now, define the functor 
\[
  \mathrm{LaxSymMon}(\cospan(\FinSet_{-}), \Set)\maps \Set \longrightarrow
  \mathrm{Cat}
\]
as follows. On objects let it map a set $\mc O$ to the lax symmetric monoidal
functor category $\mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O}), \Set)$. For
morphisms, recall from the above proof that a function $r\maps \mc O \to \mc O'$
induces a functor $R\maps \cospan(\FinSet_{\mc O}) \to \cospan(\FinSet_{\mc
O'})$ taking each $\mc O$-labelled set $N \stackrel{l}\to \mc O$ to the $\mc
O'$-labelled set $N \xrightarrow{r \circ l} \mc O'$. This in turn defines a
functor 
\begin{align*}
  \rho\maps \mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O'}), \Set) &\longrightarrow
\mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O}), \Set); \\
\Big(F'\maps
\cospan(\FinSet_{\mc O'}) \to \Set\Big) &\longmapsto \Big(R\circ F'\maps  \cospan(\FinSet_{\mc O})
\to \Set\Big).
\end{align*}
The Grothendieck construction 
\[
 \Set\int \mathrm{LaxSymMon}(\cospan(\FinSet_{-}), \Set)
\]
thus gives a category where are objects are some label set $\mc O$ together with
an object in $\mathrm{LaxSymMon}(\cospan(\FinSet_{\mc O}), \Set)$---that is,
with a lax symmetric monoidal functor $F\maps (\cospan(\FinSet_{\mc O}),+) \to
(\Set,\times)$. The morphisms $(\mc O, F) \to (\mc O,F')$ are functions of label
sets $r: \mc O \to \mc O'$ together with a natural transformation $\theta\maps
R \circ F'\Rightarrow F$.

In the case of small categories, it is not difficult to show Theorems
\ref{thm.hypdeccorcats} and \ref{thm.hypdeccorfunctors} imply:

\begin{theorem} \label{thm.equivhypdccor}
  There is an equivalence of categories
\[
  \mathrm{HypCat} \cong \Set\int \mathrm{LaxSymMon}(\cospan(\FinSet_{-}), \Set).
\]
\end{theorem}

The 2-categorical version of the above equivalence is the also the subject of a
forthcoming paper by Vagner, Spivak, and Schultz, from their operadic
perspective \cite{SpiSchRup}.

\begin{remark}
  It is prudent, to wonder, in the definition of hypergraph category, why it is
  useful to define a structure---the Frobenius maps---on a category that does
  not interact with the morphisms of the category. This affects, for example,
  invariance under equivalence of symmetric monoidal categories: given two
  equivalent symmetric monoidal categories, the hypergraph structures on these
  categories need not be in one-to-one correspondence. The Frobenius maps,
  however, are seen by the monoidal product and by hypergraph functors. Theorem
  \ref{thm.equivhypdccor} provides a more invariant definition of the category
  of hypergraph categories.
\end{remark}

\subsection{Factorisations as decorations}

We have seen that every hypergraph category can be constructed as a decorated
corelations category. More precisely, we have seen that every hypergraph
category can be constructed as a decorated corelation category with the
factorisation system the trivial isomorphism-morphism factorisation system. But
decorated corelation categories may be constructed using other factorisation
systems, and these are also hypergraph categories. How do the two constructions
relate to each other?

For each hypergraph category there is a poset of lax symmetric monoidal functors
that give decorated corelation constructions of an equivalent category.
Although the constructed categories are all equivalent, decorated corelations
only allows functors decrease the number of corelations available; corelations
are ultimately a `quotienting' construction.  The utility of decorated
corelations is that we can maintain equivalence by putting this extra,
quotiented information into the decoration.

For illustration, we first example this interaction for the simplest hypergraph
category: $\cospan(\FinSet)$, the free hypergraph category on a single object.

\begin{example}
  As per Example \ref{ex.undeccorel}, $\cospan(\FinSet)$ is the hypergraph
  category of undecorated (morphism-isomorphism)-corelations in $\FinSet$.
  Theorem \ref{thm.hypdeccorcats} shows it is also the partition-decorated
  (isomorphism-morphism)-corelations in $\FinSet$.   
  
  First, the global sections functor $G\maps \cospan(\FinSet) \to \Set$ takes
  each finite set $X$ to the set of (equivalence classes of) cospans $0 \to D
  \leftarrow X$; that is, to the set $GX$ of functions $s\maps X \to D$, where a
  unique codomain $D$ is chosen for each finite cardinality. Given a cospan $X
  \stackrel{f}\to N \stackrel{g}\leftarrow Y$, its image under the global
  sections functor is the functor $GX \to GY$ mapping $s\maps X \to D$ in $GX$
  to the function $Y \to N+_YD$ in
  \[
    \xymatrix{
      & X \ar[r]^s \ar[d]_f & D \ar[d] \\
      Y \ar[r]^g  & N \ar[r] & N+_YD
    }
  \]
  where the square is a pushout square. The coherence maps $\gamma_1\maps 1 \to
  G\varnothing$ map the unique element of $1$ to the unique function $!\maps
  \varnothing \to \varnothing$, and $\gamma_{X,Y}$ maps a pair of functions
  $a\maps X \to D$, $b\maps Y \to E$ to $a+b\maps X+Y \to D+E$. This defines a
  lax symmetric monoidal functor $(G,\gamma)$.

  A decorated \emph{cospan} in $\FinSet$ with respect to $(G,\gamma)$ is a cospan of
  finite sets $X \to N \leftarrow Y$ together with a function of finite sets $N
  \to D$. Using the isomorphism--morphism factorisation, a decorated
  \emph{corelation} is thus a cospan $X \xrightarrow{\iota_X} X+Y
  \xleftarrow{\iota_Y} Y$ together with a function $X+Y \to D$. A decorated
  corelation is thus specified by the decoration $X+Y \to D$ alone. Note that
  these are in one-to-one correspondence with cospans $X \to D \leftarrow Y$ in
  $\FinSet$ via the coproduct maps.

  As observed in the proof of Theorem \ref{thm.hypdeccorcats}, the hypergraph
  structure on $G\mathrm{Corel}$ agrees with that on $\cospan(\FinSet)$ via
  this correspondence; the multiplication $\mu_X\maps X+X \to X$ in
  $G\mathrm{Corel}$ is simply given by the decoration $(X+X)+X \to X$, and so
  on. The intuition is that in the global sections construction on a cospan
  category, the shift from cospans to corelations takes the `factored part'
  and puts it into the decoration. 

  This suggests an isomorphism; indeed, the isomorphism given by Theorem
  \ref{thm.hypdeccorcats} does precisely this. We can construct one direction,
  the one from the smaller to larger $\mc M$---that is, from $\mc M = \mc
  I_{\FinSet}$ to $\mc M = \FinSet$---as a decorated corelations
  functor.  Note that the identity on $\FinSet$ maps the subcategory $\mc
  I_{\FinSet}$ into $\FinSet$, and so extends to a morphism $\FinSet \to
  \cospan(\FinSet)$. Also recall that the `undecorated' cospan category
  $\cospan(\FinSet)$ is equal to the decorated cospan category given by the
  functor $1\maps \FinSet \to \Set$ mapping each finite set to some chosen one
  element set $1$, and each morphism to the identity morphism on $1$. Define
  monoidal natural transformation 
  \[
    \xymatrixrowsep{2ex}
    \xymatrix{
      \FinSet = \FinSet; \mc I_{\FinSet}^\opp \ar[dd]_{\iota} \ar[drr]^1  \\
      &\twocell \omit{_\:\theta}& \Set \\
      \cospan(\FinSet) = \FinSet; \FinSet^\opp \ar[urr]_{G} 
    }
  \]
  with each $\theta_X \maps 1 \to GX$ mapping the unique element to the identity
  function $1_X\maps X \to X$.  This gives the hypergraph functor we expect,
  mapping the undecorated cospan $X \to N \leftarrow Y$ to the trivial cospan $X
  \to X+Y \leftarrow Y$ decorated by $X+Y \to N$. It is now routine to verify
  this is an isomorphism.
\end{example}

The previous example extends to any category $\mc C$ with finite colimits: the
hypergraph category $\cospan(\mc C)$ can always be constructed as (i)
trivially decorated $(\mc C, \mc I_{\mc C})$-corelations, or (ii) $(\mc I_{\mc
C}, \mc C)$-corelations decorated by equivalence classes of morphisms with
domain the apex of the corelation. Moreover, the isomorphism of these
hypergraph categories is given by the analogous monoidal natural transformation
between the decorating functors.

More general still, a category of trivially decorated $(\mc E, \mc
M)$-corelations in $\mc C$ can always be constructed also as $(\mc I_{\mc C},
\mc C)$-corelations decorated by equivalence classes of morphisms in $\mc E$
with domain the apex of the corelation, and the isomorphism of these
hypergraph categories a decorated corelations functor.

Most generally, we can still perform this construction on decorated corelation
categories: Theorem \ref{thm.hypdeccorcats} implies any category of $(\mc E,\mc
M)$-decorated corelations can be constructed also as $(\mc I_{\mc C}, \mc
C)$-corelations decorated by codomain decorated morphisms in $\mc E$. Given some
lax symmetric monoidal functor
\[
  F\maps \mc C;\mc M^\opp \longrightarrow \Set,
\]
the decorated $(\mc I_{\mc C}, \mc C)$-corelations are specified by the (global
sections) functor
\[
  F'\maps \cospan(\mc C) \longrightarrow \Set
\]
taking any object $Z \in \cospan(\mc C)$ to the pair $(Z \stackrel{e}\to N,
1\stackrel{s}\to FN)$, where $e$ is a morphism in $\mc E$.

What is the utility of this variety of constructions? The first is that some
categories are very naturally constructed as corelation (or, dually, relation)
categories, like the category of equivalence relations, relations, or linear
relations. Here the factorisation system has an intuitive interpretation, like
epimorphisms retaining only the structure in the apex that is `accessible' or
`mapped onto' by the feet/boundary. Decorating this corelations retains the same
sort of intuition.

On the other hand, the `fully decorated' latter form, where all interesting
structure is carried by the apex of the decorated corelation, is useful for
constructing functors into the given decorated corelation category. The ability
to construct functors from one hypergraph category to another is essential for
the understanding of hypergraph categories as network-type diagrammatic
languages, with functors giving rise to notions of semantics, equivalence of
diagrams, and reasoning.

We will illustrate these principles in greater depth in the next path, which
delves into applications of this philosophy and framework. We conclude this
section and Part I with a collection of examples of a more abstract nature.



\section{Examples} \label{sec:excor}
We give two extended examples. Our first example is to revisit the matrix
example from the introduction, having now developed the necessary material. Our
second example is to revisit the category of linear relations once more, showing
that we can also construct it as a decorated corelation category. 

\subsection{Matrices}

Let $R$ be a commutative ring. We will construct matrices over $R$ as decorated
corelations over $\FinSet^\opp$. Here the coproduct is the Cartesian product
$\times$ of sets, the initial object is the one element set $1$, and cospans are
spans in $\FinSet$. The notation will thus be less confusing if we talk of
decorated spans on $(\FinSet,\times)$ given by the contravariant lax monoidal
functor
\begin{align*}
  R^{(-)}: (\mathrm{FinSet},\times) &\longrightarrow (\Set,\times); \\
  N &\longmapsto R^N \\
  \Big(f\maps N \to M\Big) &\longmapsto \Big(R^f\maps R^M \to R^N; v \mapsto v \circ
  f\big).
\end{align*}
The coherence maps $\varphi_{N,M}\maps R^N \times R^M \to R^{N\times M}$ take a
pair $(s,t)$ of maps $s\maps N \to R$, $t\maps M \to R$ to the pointwise product
$s\cdot t \maps N\times M \to R; (n,m) \mapsto s(n) \cdot t(m)$. The unit
coherence map $\varphi_1\maps 1 \to R^1$ sounds almost tautological: it takes
the unique element of the one element set $1$ to the function $1 \to R$ that
maps the unique element of the one element set to the multiplicative identity
$1_R$ of the ring $R$.  As described in the introduction, we show
$R^{(-)}\mathrm{Cospan}$ is the category of `multivalued matrices' over $R$, and
$R^{(-)}\mathrm{Corel}$ is the category of matrices over $R$. 

It is the coherence maps $\varphi_{N,M}$ that enact multiplication of scalars,
with the composite of $(X \xleftarrow{i_X} N \xrightarrow{o_Y} Y,\enspace N
\xrightarrow{s} R)$ and $(Y \xleftarrow{i_Y} M \xrightarrow{o_Z} Z,\enspace M
\xrightarrow{t} R)$ the span $X \leftarrow N\times_YM \rightarrow Z$ decorated
by the map
\[
  N \times_YM \hooklongrightarrow N \times M \stackrel{s \cdot t}\longrightarrow
  R,
\]
where the inclusion from $N \times_YM$ into $N \times M$ is that given by the
categorical product. We discussed the intuition for this composition rule, in
terms of paths between elements of $X$ and those of $Z$, in the introduction. 

As $\varphi_1$ essentially selects the multiplicative identity $1_R$ of $R$, the
empty decoration on any set $N$ is the function that sends every element of $N$
to $1_R$. This implies the identity map is that represented by the diagram
\[
    \tikzset{every path/.style={line width=.8pt}}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (1.75, 0.5) {};
		\node [style=sdot] (1) at (-1.75, -1) {};
		\node [style=sdot] (2) at (1.75, -1) {};
		\node [style=none] (3) at (0, -0.25) {$\vdots$};
		\node [style=amp] (4) at (0, -1) {$1$};
		\node [style=amp] (5) at (0, 1) {$1$};
		\node [style=sdot] (6) at (1.75, 1) {};
		\node [style=amp] (7) at (0, 0.5) {$1$};
		\node [style=sdot] (8) at (-1.75, 0.5) {};
		\node [style=sdot] (9) at (-1.75, 1) {};
		\node [style=none] (10) at (1.75, -0.25) {$\vdots$};
		\node [style=none] (11) at (-1.75, -0.25) {$\vdots$};
		\node [style=none] (12) at (-2.125, 1) {$x_1$};
		\node [style=none] (13) at (-2.125, 0.5) {$x_2$};
		\node [style=none] (14) at (-2.125, -1) {$x_n$};
		\node [style=none] (15) at (2.125, 1) {$x_1$};
		\node [style=none] (16) at (2.125, 0.5) {$x_2$};
		\node [style=none] (17) at (2.125, -1) {$x_n$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (6) to (5);
		\draw (4) to (2);
		\draw (1) to (4);
		\draw (5) to (9);
		\draw (8) to (7);
		\draw (7) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
\]
while the Frobenius multiplication and unit are 
\[
    \tikzset{every path/.style={line width=.8pt}}
  \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (1.75, -0.5) {};
		\node [style=sdot] (1) at (1.75, -2.25) {};
		\node [style=none] (2) at (0, -1.25) {$\vdots$};
		\node [style=amp] (3) at (0, -2.25) {$1$};
		\node [style=amp] (4) at (0, 1.5) {$1$};
		\node [style=sdot] (5) at (1.75, 1.5) {};
		\node [style=amp] (6) at (0, -0.5) {$1$};
		\node [style=sdot] (7) at (-1.75, -0.5) {};
		\node [style=none] (8) at (1.75, -1.25) {$\vdots$};
		\node [style=none] (9) at (-1.75, -1.25) {$\vdots$};
		\node [style=sdot] (10) at (-1.75, -2.25) {};
		\node [style=sdot] (11) at (-1.75, 1.5) {};
		\node [style=none] (12) at (2.125, 1.5) {$x_1$};
		\node [style=none] (13) at (2.125, -0.5) {$x_2$};
		\node [style=none] (14) at (2.125, -2.25) {$x_n$};
		\node [style=none] (15) at (-2.5, 1.5) {$(x_1,x_1)$};
		\node [style=none] (16) at (-2.5, -0.5) {$(x_2,x_2)$};
		\node [style=none] (17) at (-2.5, -2.25) {$(x_n,x_n)$};
		\node [style=none] (18) at (-2.5, 1) {$(x_1,x_2)$};
		\node [style=sdot] (19) at (-1.75, 1) {};
		\node [style=none] (21) at (-1.75, 0.5) {$\vdots$};
		\node [style=none] (22) at (1.75, 0.75) {$\vdots$};
		\node [style=sdot] (23) at (-1.75, -0) {};
		\node [style=none] (24) at (-2.5, -0) {$(x_2,x_1)$};
		\node [style=sdot] (25) at (-1.75, -1.75) {};
		\node [style=none] (26) at (-2.7, -1.75) {$(x_n,x_{n-1})$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5) to (4);
		\draw (3) to (1);
		\draw (7) to (6);
		\draw (6) to (0);
		\draw (10) to (3);
		\draw (4) to (11);
	\end{pgfonlayer}
\end{tikzpicture}
  \end{aligned}
  \qquad \mbox{and} \qquad
  \begin{aligned}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=sdot] (0) at (1.75, 0.5) {};
		\node [style=sdot] (1) at (1.75, -1) {};
		\node [style=none] (2) at (0, -0.25) {$\vdots$};
		\node [style=amp] (3) at (0, -1) {$1$};
		\node [style=amp] (4) at (0, 1) {$1$};
		\node [style=sdot] (5) at (1.75, 1) {};
		\node [style=amp] (6) at (0, 0.5) {$1$};
		\node [style=sdot] (7) at (-1.75, -0) {};
		\node [style=none] (8) at (1.75, -0.25) {$\vdots$};
		\node [style=none] (9) at (2.125, 1) {$x_1$};
		\node [style=none] (10) at (2.125, 0.5) {$x_2$};
		\node [style=none] (11) at (2.125, -1) {$x_n$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5) to (4);
		\draw (3) to (1);
		\draw (7) to (6);
		\draw (6) to (0);
		\draw (7) to (4);
		\draw (7) to (3);
	\end{pgfonlayer}
\end{tikzpicture}
  \end{aligned}
\]
respectively, with the comultiplication and counit the mirror images.

These morphisms are multivalued matrices in the following sense: the
cardinalities of the domain $X$ and the codomain $Y$ give the dimensions of the
matrix, and the apex $N$ indexes its entries. If $n \in N$ maps to $x \in X$ and
$y \in Y$, we say there is an entry of value $s(n) \in \R$ in the $x$th row and
$y$th column of the matrix. It is multivalued in the sense that there may be
multiple entries in any position $(x,y)$ of the matrix.


To construct matrices proper as decorated relations, we extend $R^{(-)}$ to the
contravariant functor
\[
  R^{(-)}: (\mathrm{Span(FinSet)},\times) \longrightarrow (\Set,\times)
\]
mapping now a span $N \stackrel{f}\leftarrow A \stackrel{g}\to M$ to the
function
\begin{align*}
  R^{f^\opp;g}\maps R^M &\longrightarrow R^N; \\
  v &\longmapsto \Big(n \mapsto \sum_{a \in f^{-1}(n)} v\circ g(a)\Big).
\end{align*}
It is simply a matter of computation to check this is functorial.

Decorated corelations in this category then comprise trivial spans $X
\xleftarrow{\pi_X} X \times Y \xrightarrow{\pi_Y} Y$, where $\pi$ is the
projection given by the categorical product, together with a decoration $X\times
Y \to R$. Such morphisms give a value of $R$ for each pair $(x,y) \in X \times
Y$, and thus are trivially in one-to-one correspondence with $\lvert X \rvert
\times \lvert Y\rvert$-matrices. 

The map $R^{-}\mathrm{Cospan} \to R^{-}\mathrm{Corel}$ transports the decoration
$N\times_YM \to R$ along the function $N \times_YM \to N \times M$ that
identifies elements over the same pair $(x,y)$. In terms of the multivalued
matrices, this sums over (the potentially empty) set of entries over $(x,y)$ to
create a single entry. It is thus easily observed that composition in this
category is matrix multiplication. Moreover, it is not difficult to check that
the monoidal product is the Kroenecker product of matrices, and thus that
$R^{-}\mathrm{Corel}$ is monoidally equivalent to the monoidal category of
finite dimensional vector spaces and linear maps.

%Many aspects of this example are `atypical' for the intuition we have been
%working towards.  Note that the monoidal product here is the tensor product of
%matrices, not the biproduct. Indeed, there is no special commutative Frobenius
%algebra in $\Vect$ if we use the biproduct, but if we use the tensor product
%then these correspond to orthonormal bases (Vicary), as they do here.  

We note that you could take decorations here in the category $R\mathrm{Mod}$ of
$R$-modules. While Proposition \ref{prop.setdecorations} shows that the
resulting decorated cospans category would be isomorphic, this may hint at an
enriched version of the theory.

\subsection{Two constructions for linear relations}

We saw in \textsection\ref{ssec.linrel} that linear relations are epi-mono
corelations in $\Vect$. As linear relations thus form a hypergraph category
$\LinRel$, we can also give a decorated corelations construction. 

Indeed, the global sections functor of the hypergraph category $\LinRel$, which
we shall write
\[
  \mathrm{Lin} \maps\mathrm{Cospan}(\mathrm{FinSet}) \longrightarrow \mathrm{Set}
\]
takes a finite set $N$ to the set $\mathrm{Lin}(N)$ of linear subspaces of the
vector space $k^N$. Moreover, the image $\mathrm{Lin}(f)$ of a function $f\maps
N \to M$ maps a subspace $L \subseteq k^N$ to $\{v \mid v\circ f \in L\}
\subseteq k^M$, while the image $\mathrm{Lin}(f^\opp)$ of an opposite function
$g^\opp: N \to M$ maps a subspace $L \subseteq k^N$ to $\{v = u \circ g \mid u
\in L\} \subseteq k^M$. 

Given this functor, $\mathrm{LinCospan}$ is the category of cospans decorated by
subspaces, and $\mathrm{LinCorel}$ is the category of linear relations. 

This is important for circuits work \cite{BF,BSZ}. Recall the functor
$\linsub\maps \FinSet \to \Set$ of Section \ref{sec:ex}, which takes a finite
set $X$ to the set of subspaces of $\R^X \oplus (\R^X)^*$.  This may be extended
to a functor $\cospan(\FinSet) \to \Set$, giving a decorated corelations
category of linear relations between a vector space and its dual. Recall also
that in Section \ref{sec:ex} we discussed a functor 
\[
  \mathrm{GraphCospan} \to \mathrm{LinSubCospan}
\]
interpreting labelled graphs as linear subspaces. Composing this with the
quotient functor $\mathrm{LinSubCospan} \to \mathrm{LinSubCorel}\cong \LinRel$,
this gives a compositional linear relations semantics for circuit diagrams. This
hints at the material we explore in greater depth in Chapter \ref{ch.circuits}.


%DISCUSS HYPERGRAPH STRUCTURE?

%\subsection{Automata}
%This construction comes immediately from Walters et al. Automata are alphabet
%labelled graphs. There is a decorated cospan functor to categories enriched over
%languages, and this factors nicely to get a decorated corelation category with
%morphisms languages recognised between points in domain and codomain.
%
%a category of nondeterministic finite state automata
%
%a category of regular languages
%
%idea of black boxing is a Kleene theorem.







%  Our proof will have an inductive flavour. We first assume $\corel_(\mc C)$ is
%  well-defined as a hypergraph category, and show  We caution that we still have not proved that $\corel(\mc C)$ is a category,
%  let alone a hypergraph category. Thus to begin, all we can show is that the map
%  $\square$ is composition-preserving, and then that $\square$ respects the
%  monoidal and hypergraph structure. But this is enough to prove both
%  results! Indeed, specialising to the case where $A$ is the identity functor on
%  $\mc C$ and $(\mc E,\mc M)=(\mc C, \mc I_{\mc C})$, observe   
%  \[
%    \square \maps \cospan(\mc C) \longrightarrow \corel(\mc C)
%  \]
%  is then the map taking each cospan to its jointly $\mc E$-like part. Note
%  $\square$ maps fully (surjectively-on-morphisms) and bijectively-on-objects
%  onto $\corel(\mc C)$, and by definition the coherence and hypergraph maps on
%  $\corel(\mc C)$ are precisely the image of the corresponding maps of
%  $\cospan(\mc C)$. As $\cospan(\mc C)$ is a hypergraph category and $\square$
%  is composition-preserving, we can consequently conclude that all corelation
%  categories are indeed hypergraph categories, and hence that $\square$---in the
%  general case---is a hypergraph functor.
%
%  Finally, specialising to the case where $A$
%  is the identity functor on $\mc C$ and $(\mc E,\mc M)$ is the factorisation
%  system $(\mc C, \mc I_{\mc C})$, we observe that the domain of $\square$ is
%  then $\cospan(\mc C)$, and that $\square$ maps it fully
%  (surjectively-on-morphisms) and bijectively-on-objects onto $\corel(\mc C')$.
%  This shows that all corelation categories are indeed deserving of the name
%  category and moreover hypergraph category, and hence that $\square$ is
%  deserving of the name hypergraph functor.
